<!DOCTYPE HTML>
<head>
  <meta charset="utf-8">
  <title>Plotato User Manual</title>
  <style>
        html{
            scroll-behavior: smooth;
        }
        body{
            background: rgb(144, 144, 144);
            padding:0;
            margin:0;            
        }
        .flexcontainer{
            display: flex;
            }
        nav{
            background: linear-gradient(to right, rgb(88,88,88) 0%, rgb(98,98,98) 50%, rgb(144, 144, 144) 100%);
            min-width: 38ch;
            padding: 0 1em;
        }
        main{
            display: flex;
            flex-direction: column;
            max-width: min(60vw, 120ch);
            margin-left: max(0px , calc(50vw - 79ch));
            background: linear-gradient(to right, rgb(144, 144, 144), rgb(180, 180, 180), rgb(144, 144, 144));
        }
        h1{
            color: white;
            text-align: center;
            background: rgba(98, 98, 98, 0.5);
            padding: 1em;  
            border-radius: 5px;
            box-shadow: black 0px 10px 15px -12px;
            margin: 1em auto;
            width: 90%;
            text-shadow: black 1px 1px 5px;
        }
        h2{
            color: rgb(240, 240, 240);
            background: rgba(98, 98, 98, 0.7);
            padding: 0.2em;
            border-radius: 5px;
            box-shadow: black 0px 10px 15px -12px;            
        }

        nav ul{
            margin:0;
            padding: 0 1em;
            list-style-type: square;
        }

        p{
            font-size: 110%;
            margin: 1em;
        }
        pre
        {
           overflow: auto; 
        }
        img{            
            display: block;
            margin-bottom: 1em;
            max-width: min(60vw, 120ch);
        }
        a{
            font-size: 120%;
            text-shadow: black 0px 0px 4px;
        }
        a:link {
            color: rgb(255, 183, 90);
        }
        a:visited {
            color: rgb(255, 183, 90);
        }
        a:hover {
            color: rgb(157, 255, 90);
        }
        a:active {
            color: rgb(104, 255, 0);
        }
        .api_inline{
            color: hotpink;
            font-family: monospace;
            background: rgb(30,30,30);
        }
        .api_def{
            color: hotpink;
            margin-left: 10px;
        }
        .api_num{
            color: lime;
        }
        .api_doc{
            color: yellow;
            margin-left: 40px;
            margin-bottom: 20px;
        }
        .api{
            font-family: monospace;
            font-size: 16px;
            color: lightskyblue;
            background: rgba(0,0,0, 0.8);
            border-radius: 5px;
            padding: 1em;
        }
        .bottom_right{
            position: fixed;
            bottom: 5px;
            right: 5px;
        }
        .overscroll_img_x {
          position: absolute;
          width: 640px;
          height: 320px;
          object-fit: cover;
          object-position: 0% 0%;
          animation-name: scroll_x;
          animation-duration: 8000ms;
          animation-iteration-count: infinite; 
          animation-timing-function: linear;         
          animation-direction: alternate;
          -webkit-user-select: none;
          user-select: none;
        }
        @keyframes scroll_x {
          0% { object-position: 0% 100%;}
          100% {object-position: 100% 100%;}
        }
        .license{
            text-align: center;
            margin-bottom: 6em;
        }
        .license img{
            display: inline;
            margin: 0;
        }
  </style>
</head>

<body>
    <a class='bottom_right' href='#top'>[Back to top]</a>
    <div class='flexcontainer'>
        <nav id='top'> 
        <br>
            <ul>
              <li><a href='#introduction'>Introduction</a></li>
               <li><a href='#html_structure'>HTML Structure</a></li> 
              <li>
                <a href='#engine'>Engine Features</a>
                <ul>
                <li><a href='#background'>Background Image</a></li>
                <li><a href='#parallax'>Parallax Images</a></li>
                <li><a href='#player'>Player Character (PC)</a></li>
                <li><a href='#npc'>Non-Player Character(NPC)</a></li>
                <li><a href='#datastore'>DataStore</a></li>
                <li><a href='#node'>Plot Node (node)</a></li>
                <li><a href='#plot'>Plot Graph (plot)</a></li>
                <li><a href='#choice'>Choice</a></li>
                <li><a href='#branch'>Branch</a></li>
                <li><a href='#jump'>Jump</a></li>
                <li><a href='#cmd'>Command (cmd)</a></li>
                <li><a href='#filter'>Filter</a></li>
                <li><a href='#overlay'>Overlay</a></li>
                <li><a href='#autosave'>Autosave</a></li>
                <li><a href='#rollback'>Rollback</a></li>
                <li><a href='#modal'>Modal Screens</a></li>
                <li><a href='#quests'>Quests</a></li>
                <li><a href='#clothes'>Clothes</a></li>
                <li><a href='#shops'>Shops</a></li>
                <li><a href='#map'>Map</a></li>
                <li><a href='#events'>Map Events</a></li>
                <li><a href='#time'>Time</a></li>
                <li><a href='#tce'>Time Critical Events</a></li>
                <li><a href='#audio'>Audio</a></li>
                <li><a href='#tts'>Text to Speech (TTS)</a></li>
                <li><a href='#mods'>Mods</a></li>
                </ul>
              </li>
              <li><a href='#customizing'>Customizing Your Game </a></li>
              <li><a href='#dirs'>Directories Structure</a></li>
              <li><a href='#data'>Data Files</a></li>
              <li><a href='#tools'>Tools</a>
                <ul>
                <li><a href='#plot_edit'>Plot Editor</a></li>
                <li><a href='#item_edit'>Item Editor</a></li>
                <li><a href='#item_maker'>Item Maker</a></li>
                <li><a href='#shop_edit'>Shop Editor</a></li>
                <li><a href='#mod_manager'>Mod Manager</a></li>
                <li><a href='#scripts'>Python scripts </a></li>
                </ul>
              </li>
              <li><a href='#api'>API</a></li>
            </ul>
        </nav>

        <main>
            <h1 id='introduction'>Introduction </h1>
                <article>
                    <h3> Welcome to the Plotato Engine User Manual </h3>
                    <img src='manual_img/logo.webp'>
                    <p>
                        Note: This document is still a Work-In-Progress.
                    </p>

                    <p>
                        The Plotato is a free and open sourced, visual novel game engine, written as a Single Page App using Python (Brython), HTML, CSS and a minimal amount of Javascript.  
                    </p>
                    <p>
                        It was designed to run from the players hard drive without the need for a server, both on desktop and 
                        mobile (Android) devices, but it can run just as well from a remote server (as a static website, oe PWA) or 
                        embedded in a Electron app (with some extra steps).
                    </p>
                    <p>
                        The name Plotato is a portmanteau of the words 'plot' and 'potato', as it is focused on quickly and efficiently developing complex plots and compared to 'full fledged' game engine it has the functionality of a potato, being able to do little else beyond displaying images and blobs of text. 
                    </p>
                    <p>
                        Plotato has been strongly inspired by the popular Ren'Py engine, but only in the way the game is presented to the player (full-screen image with a bit of text at the bottom and maybe some pc/npc sprites in between).  
                    </p>
                    <p>
                        Some programming skills are required to make a Plotato game, but usually You won't need to write programs nor functions and you won't need to design algorithms.  
                    </p>
                    <p>
                        You may need to learn how to write Python expressions for example to save some information for later use, like: <span class="api_inline">save.end_of_shift = get_hour() + 8</span>
                    </p>
                    <p>
                        You may need to learn how to write conditions: (if) <span class="api_inline"> get_hour() > save.end_of_shift</span>
                    </p>
                    <p>
                        You will definitely need to learn how to call Python functions:
                        <span class="api_inline">set_tce('pool_party', 12, 15, 'map_home', 'remind_party')</span>
                    </p>
                    <p>
                        For customizing the look of the game you will need to know at least some CSS, but the game uses bog standard, verbose CSS in a everything-is-a-class paradigm. In most cases you can just use right-click anything, bring up the developer tool, mess about with the styling until you get the element to look as you want it to, and copy/paste the changes back into style/default.css.  
                    </p>

                    <p>
                        All the codebase for the engine is provided in plain text format. Nothing is minimized, nothing is obfuscated, every single function and class is documented. The engine has about ~400 lines of HTML, ~3000 lines of Python and ~1200 lines of CSS - including comments and blank lines (+2x as much for all the tools). One could read and understand all of it in one afternoon.  
                    </p>

                    <p>
                        The engine is distributed under a lax, permissive free software license. One can use, copy, modify, and/or distribute this software for any purpose with or without fee, with the only restriction being that a copyright notice isn't removed. There is no GPL poison.  
                    </p>
                    
                    <a href='#top'>[Back to top]</a>
                </article>   
            <h1 id='html_structure'>HTML Structure </h1>
                <article>
                    <p>
                        The game engine uses div markers for specific elements. Most of them h#ave unique classes and 
                        any div that is manipulated later by the Python script has a unique id.
                    </p>
                    <p>
                        Elements that are hidden by default have a local style set overriding their display property to none
                        <span class='api_inline'>style="display: none;"</span>. This is also how the engine hides elemnts 
                        using the <span class='api_inline'>_show( element_id, show=False )</span> function.
                    </p>
                    <h2>Head</h2>
                    <p>
                        There is very little here beyond what one would normally find in a html document head. Meta tags,
                        scripts (Brython), css reference. Depending on the version there might be a small helper javascript function
                        defined here that is used for text-to-speech.
                    </p>
                    <h2>Body</h2>
                    <h3>svg</h3>
                    <p>The svg tag at the top is used only to define the filters. </p>
                    <ul>
                        <li>filter_night</li>
                        <li>filter_default</li>
                    </ul>
                    <h3>error_box</h3>
                    <p>This div is a placeholder for errors displayed via <span class='api_inline'>show_error()</span></p>
                    
                    <h3>mod_menu</h3>
                    <p>This is a div where mod creators can add their own widgets using <span class='api_inline'>add_mod_cfg()</span</p>
                    
                    <h3>tts_config</h3>
                    <p>This is a div with text-to-speech configuration. </p>
                    
                    <h3>history</h3>
                    <p>This is a placeholder div for displaying the playthrough history.</p>
                    
                    <h3>modal</h3>
                    <p>This is a placeholder/template for modal widgets (pop-ups)</p>
                    
                    <h3>copyright</h3>
                    <p>Container for displaying the version and copyright notice at the bottom</p>
                    
                    <h3>portrait_mode</h3>
                    <p>Used only to display a message prompting the user to flip his device if the game window is tallar then wider.</p>
                    
                    <h3>click_anywhere</h3>
                    <p>An element coverint all available space, used to capture mouse click events after hiding the game controls.</p>
                    
                    <h3>music_player</h3>
                    <p>Placehooder for embedded audio.</p>
                    
                    <h3>spacer</h3>
                    <p>Empty space at the bottom, added to help with the page layout.</p>
                    
                    <h3>container</h3>
                    <p>This is the main game window, all widgets apart from the ones mention above are placed inside this div.</p>
                    
                    <h3>imgs</h3>
                    <p> Images (background images) are rendered into this div</p>
                    
                    <h3>imgs_aux</h3>
                    <p>Used for images other than the main image (parallax scrolling images)</p>
                    
                    <h3>npc_img</h3>
                    <p>The NPC image. This is a single img tag, as only one NPC can be displayed at once.</p>
                    
                    <h3>pc_imgs</h3>
                    <p>PC images are placed here.</p>
                    
                    <h3>imgs_overlay</h3>
                    <p>Placeholder for overlay images (usually rendered on top of pc and npc images)</p>
                    
                    <h3>credits</h3>
                    <p>Used for displaying credits</p>
                    
                    <h3>choice_box</h3>
                    <p>Placeholder for choice buttons</p>
                    
                    <h3>cloths</h3>
                    <p>Th shop/wardrobe UI. Has a lot of elements, see source.</p>
                    
                    <h3>status</h3>
                    <p>Status bar placeholder (for time, money and other? stats)</p>
                    
                    <h3>main_txt</h3>
                    <p>Container for the text. The player usually needs to click on it to progress the story, so appart from the 
                    styling, there are click event listeners attached to this div</p>
                    
                    <h3>left_corner, right_corner</h3>
                    <p>Placeholders for positioning widgets in the right and left top corners.</p>
                    
                    <h3>settings</h3>
                    <p>Container for the settings/options/mods and save/load buttons, see source for details.</p>
                    
                    <h3>questlog</h3>
                    <p>Container for the quest log entries.</p>
                    
                    <h3>rollback</h3>
                    <p>Container for the  rollback button and description</p>
                    
                    <h3>overlay</h3>
                    <p>Used for css overlay effects - like <span class='api_inline'>splash()</span></p>
                    
                    <h3>loading</h3>
                    <p>Container onlyused for displaying a loading message</p>
                    
                    <h3>monetize</h3>
                    <p>Container for support/monetize buttons</p>
                    
                    
                    <a href='#top'>[Back to top]</a>
                </article>
            <h1 id='engine'>Engine Features </h1>
                <article>
                    <p>In this section you can find a brief description of most of the key features
                    of the engine. You will learn what they are, what they can be used for and
                    how to actually use them.
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='background'>Background Image</h2>
                <article>
                    <p>As the name suggest - background images are the images in the background.
                    In this document the background image may also be called the main image or just image.
                    </p>
                    <p>You can have only one background image per node (scene) and what image gets
                    displayed is defined inside the node. Details about how to add an image to a node are
                    described in the Plot Nodes section and in the Plot Editor section.</p>
                    <p>Images should be exactly 1280x720 and saved in any format supported by
                    browsers (png, jpg, webp, etc). If you need your images at a different
                    resolution you may need to change how PC and NPC images are show, how and
                    where map markers are shown and probably also change the behavior of overlays.
                    </p>
                    <p>The background image is always rendered behind the player and NPC images,
                    it is also usually rendered behind the overlay, but that can be changed
                    in the overlay specific css (using "z-index: -1;" css property).
                    </p>
                    <p>Background images are not affected by Filters.</p>
                    <p>The background image use the 'main_img' css class. </p>
                    <p>By default when a new image is show it is gradually ( in 0.5 of second) faded in
                    on top of the old/existing image and once this animation is complete the
                    old image is removed.
                    </p>
                    <p>The images are not cached or pre-loaded in any way other
                    than what the browser (and/or server) provides for any image.</p>

                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='parallax'>Parallax Images</h2>
                <article>
                    <p>Parallax images where primary designed to show scrolling (background) images
                    with a parallax effect - that is where objects in the distance move slower then
                    objects nearby.
                    </p>
                    <p>Parallax images are scrolled across the viewport either horizontally or vertically.</p>

                    <p>To get a parallax effect you need to have at least two images, with the
                    background image proportionally smaller compared to the foreground. But you are
                    not limited to just two images, you can add as many as you like - but keep in mind that
                    each additional image may degrade performance. </p>
                    <p>This feature can also be used to show only one image - in that case
                    it will just be scrolled across the viewport.
                    </p>

                    <p> To add a parallax image to a plot node you need to call the
                    parallax_imgs() function (add it as a cmd)
                    </p>
                    <div class='api'>
                        <span class='api_def'>parallax_imgs</span>(*args, **kwargs)
                        <div class='api_doc'>
                        img_list - image or is a list of images to display.<br>
                        either should be a valid url (preferably relative for offline use)<br>
                        eg.: parallax_imgs('img/big/lazy.webp')<br>
                        When multiple images are use they should be passed in back-to-front order,<br>
                        that is the smallest, most far away image first and the biggest, closes image last.<br>
                        scroll_dir - should be either 'y' (default) or 'x'<br>
                        if scroll_dir='y' the image(s) will be scrolled from top to bottom<br>
                        if scroll_dir='x' the image(s) will be scrolled from side to side<br><br>

                        Note: the new implementation uses star arguments, it can be called either with a list/tuple or with comma separated arguments eg:<br>
                        parallax_imgs(['img/parallax/class_l0.webp', 'img/parallax/class_l1.webp', 'img/parallax/class_l2.webp'])<br>
                        parallax_imgs('img/parallax/class_l0.webp', 'img/parallax/class_l1.webp', 'img/parallax/class_l2.webp')<br>
                        parallax_imgs('img/big/lazy.webp')<br>
                        parallax_imgs('img/parallax/roof_l0.webp', 'img/parallax/roof_l1.webp', 'img/parallax/roof_l2.webp', scroll_dir='x')
                        </div>

                        <span class='api_def'>replace_parallax_img</span>(new_img_url, layer=<span class='api_num'>0</span>)
                        <div class='api_doc'>
                        Replace one (1) image in the parallax image stack, without resetting the animation<br>
                        new_img_url - the url of the new image<br>
                        layer - index of the image to replace, numbered from back to front, in the same order as passed to parallax_imgs()
                        </div>

                    </div>
                    <p>Example in editor:
                    <img src='manual_img/parallax_in_editor.png'>
                    </p>

                    <p>Parallax effect example (notice the clouds in the background scrolling at a different rate compared to the foreground):
                        <div style="height: 320px;">
                        <img src='manual_img/roof_l0.webp' class="overscroll_img_x">
                        <img src='manual_img/roof_l1.webp'class="overscroll_img_x">
                        <img src='manual_img/roof_l2.webp'class="overscroll_img_x">
                        </div>
                    </p>

                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='pc'>Player Character (PC)</h2>
                <article>
                    <p> The term Player Character (or PC for short) refers only to the paper doll avatar, an image or series of images displayed on top of the background image.
                    </p>
                    <p> By convention the player controlled character is always displayed on the left side of the screen and the NPC (Non-Player-Characters) are displayed on the right.
                    This arrangement can easily be changed by editing the style/default.css style sheet (.pc_img and .pc_imgs classes).
                    </p>
                    <p>Unlike the NPC image, the PC image is dynamic by default.
                    It's not a single image but a stack of images depicting the characters body, clothing, facial expression and hair.
                    </p>
                    <p> Depending on the flavor/version of the engine there can also be additional layers like tattoos, piercings and overlays.
                    You can add and remove these additional layers as you feel fit, just add (copy/paste) another img tag in the 'pc_imgs' div.
                    The order in which the img tags are added to that div matters - this is the order the images will be drawn (so nude/base body should go first, before clothing and facial expressions).
                    </p>
                    <p> The PC also supports svg filters - by default there are 2 such filters provided, the 'default' filter draws a shadow behind the images (respecting transparency)
                    and the 'night' filter tints the avatar blue-ish (and also draws a shadow). This is a useful feature that allows to recolor the avatar at runtime.
                    Both PC and NPC are set up in such a way that changing the filter changes both NPC and PC images (without affecting the background) - more on that later.
                    </p>
                    <p> There is an option to overlay a image on top of the player avatar, this overlay can also use mix-bled-modes as supported by css.
                    </p>
                    <p> The individual parts/images of the avatar can by programmatically replaced not just once but in such a way that each time the avatar is show the replaced parts will show the correct new image (for instance to replace one hairstyle with another.)
                    </p>
                    <p>Another dynamic aspect is the clothing system, but that is described in a further chapter.
                    </p>
                    <p> The PC system is deeply embedded into the engine, it's data files and editor.
                    Usually all that the game creator needs to do is to select the facial expression for the avatar in the editor
                    and the engine will do the rest. Selecting no expression means that the avatar should stay hidden.
                    </p>
                    <div class='api'>
                        <span class='api_def'>show_pc</span>(visible=<span class='api_num'>True</span>, face=<span class='api_num'>None</span>)
                        <div class='api_doc'>
                         Show the pc avatar image with the current clothing and face<br>
                         Note: This function is usually called automatically
                         </div>

                        <span class='api_def'>set_bodypart_img</span>(bodypart, img_path)
                        <div class='api_doc'>
                        Change the image for a bodypart <br>
                        bodypart - name of the bodypart to replace (same as the img tag id)<br>
                        img_path - should be the relative path/url to the img <br>
                         </div>

                        <span class='api_def'>set_body_overlay</span>(img_name=<span class='api_num'>None</span>, <span class='api_num'>img_path='img/pc/'</span>)
                        <div class='api_doc'>
                        Adds a overlay image on top of the pc image stack<br>
                        The final url for the image is img_path+img_name, so usually it's enough to provide the image filename.<br>
                        If img_name is None the overlay is removed.
                        </div>

                        <span class='api_def'>save.pc_is_wet</span> = <span class='api_num'>0</span><br>
                        <span class='api_def'>save.pc_is_wet</span> = <span class='api_num'>1</span>
                        <div class='api_doc'>
                            In some versions of the engine one can add a 'wet look' overlay by just setting this one DataStore variable.
                        </div>

                        <span class='api_def'>add_pc_bodymod</span>(name, img, mod_type=<span class='api_num'>'piercing'</span>)
                        <div class='api_doc'>
                        Add a body modifications image and flag.<br>
                        name - string used for the flag, can be retrieved by <span class='api_def'>save.get_flags('bodymods')</span><br>
                        img - image url for the avatar <br>
                        mod_type - can be 'piercing' or 'tattoo' <br>
                        Note: This function will silently fail if PC has 3 or more bodymods of one type<br>
                        If PC has bodymods, each time a new background image is show the game will also add
                        a image for every bodymod the PC has, it will use the name/path of the background image as reference
                        and construct a new url using the pattern <span class='api_num'>img_name+'_'+name+'.'+img_ext</span>
                        where:<br>
                         img_name - is the name(url) of the background image without the extension <br>
                         name - is the name of the bodymod as provided by add_pc_bodymod()<br>
                         img_ext - is the extension the background image
                        Eg. if the game shows a background image like:<br>
                         _show_new_img('img/scene_1/foobar.png')<br>
                         and the PC has a bodymod like: <br>
                         add_pc_bodymod('nose_ring', img='img/pc/gold_ring1.png', mod_type='piercing')<br>
                         The game will add a image on top with the url:<br>
                         'img/scene_1/foobar_nose_ring.png'.<br>
                         It works even if that image doesn't exist (at least on mainstream browsers).
                        </div>

                        <span class='api_def'>num_pc_bodymods</span> (mod_type=<span class='api_num'>'piercing'</span>)
                        <div class='api_doc'>
                        Get the number of body modifications the PC currently has <br>
                        mod_type - can be 'piercing' or 'tattoo'
                        </div>
                    </div>

                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='npc'>Non-Player Character(NPC)</h2>
                <article>
                    <p> Non-Player Character ( or NPC for short) refer to the avatar image of the NPC.
                    </p>
                    <p> By convention the NPC  character is always displayed on the right side of the screen and the PC is displayed on the left.
                    This arrangement can easily be changed by editing the style/default.css style sheet (.npc_img class).
                    </p>
                    <p> The NPC image are static and there is only ever one NPC image displayed at the same time.
                    </p>
                    <p> The NPC supports svg filters - by default there are 2 such filters provided, the 'default' filter draws a shadow behind the images (respecting transparency)
                    and the 'night' filter tints the avatar blue-ish (and also draws a shadow). This is a useful feature that allows to recolor the avatar at runtime.
                    Both PC and NPC are set up in such a way that changing the filter changes both NPC and PC images (without affecting the background) - more on that later.
                    </p>
                    <p> The NPC system is deeply embedded into the engine, it's data files and editor.
                    Usually all that the game creator needs to do is to select the name of the NPC from the editor.
                    </p>
                    <p>
                        For situations where the NPC image can't be determined beforehand or one needs a dynamic or random image, a f-string can be used in place of the image name. For example one can set a save variable
                        <span class='api_inline'>save.rand_npc_img = randint(5)</span> and then use <span class="api_inline">img/npc/random_npc_{save.rand_npc_img}.png</span> to display one of a few pre-made random npc avatars. 
                    </p>
                    <div class='api'>
                        <span class='api_def'>_show_npc</span>(npc_img)
                        <div class='api_doc'>
                         Show or hide (if npc_img is None/False) the npc image<br>
                         Note: This function is usually called automatically
                         </div>
                    </div>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='datastore'>DataStore</h2>
                <article>
                    <p> DataStore is the interface the game uses for persistent data.
                    The default implementation uses localStorage as the backend, but other mechanisms can be used.
                    </p>
                    <p>
                        If for some reason the engine can't access the browsers localStorage (write and read back values),
                        a fallback implementation is used, but in that case the user needs to manually save and load and
                        all unsaved progress is lost.
                    </p>
                    <p> By default when the game starts the following DataStore are created:
                        <ul style=" margin-left: 2em;">
                            <li>cfg (game configuration)</li>
                            <li>save (saves and current game state)</li>
                            <li>inventory (items/clothes in pc's possession)</li>
                            <li>quests (current quests status)</li>
                            <li>rollback_* (as above, but used for rollback)</li>
                        </ul>
                    </p>
                    <p>DataStore implements both a dictionary like interface as well as 'doted' access.
                    For example if you want to store a value for later, you can use
                    <span class='api_inline'>save.some_value = 14</span>
                    or
                    <span class='api_inline'>save['some_value'] = 14</span><br>
                    There's also a add_item() function that has the same functionality:<br>
                    <span class='api_inline'>save.add_item('some_value', 14)</span><br>
                </p>
                <p>
                    Because of the way the doted access is implemented there are some restricted key names that you should not use. These are:<br>
                    <ul style=" margin-left: 2em;">
                        <li>__init__</li>
                        <li>inner_dict</li>
                        <li>__inner_dict</li>
                        <li>__getitem__</li>
                        <li>_name</li>
                        <li>db_storage</li>
                        <li>__getitem__</li>
                        <li>__setitem__</li>
                        <li>add_item</li>
                        <li>set_list</li>
                        <li>get_list</li>
                        <li>append_list</li>
                        <li>del_from_list</li>
                        <li>is_empty</li>
                        <li>items</li>
                        <li>clear</li>
                        <li>add_flag</li>
                        <li>has_flag</li>
                        <li>get_flags</li>
                        <li>remove_flag</li>
                        <li>remove</li>
                        <li>to_string</li>
                        <li>from_string</li>
                        <li>__contains__</li>
                        <li>__getattr__</li>
                        <li>__setattr__</li>
                        <li>__delitem__</li>
                    </ul>
                    </p>
                    <p> DataStore also has a default (zero) value for non-existing keys.
                    This is made so that you can test values in the storage without the need to first test if the values exist.
                    For example, you can do <span class='api_inline'>if save.some_value: do_something()</span>
                    even if you never used save.some_value or save['some_value'] (save.some_value will evaluate to 0)
                    </p>
                    <p> You can test if values have been set using the 'in' operator.<br>
                    <span class='api_inline'>if 'some_value' in save: </span>
                    </p>
                    <p>You can iterate over the values like you would with any dictionary using the .items() function.<br>
                    <span class='api_inline'>for key, value in save.items()</span>
                    </p>

                    <p> DataStore can save value types that can be serialized to JSON, that is:
                        <ul style=" margin-left: 2em;">
                            <li> strings ('some value')</li>
                            <li> integers (42)</li>
                            <li> floats (3.14)</li>
                        </ul>
                    </p>
                    <p>
                    It is recommended to store boolean values (True, False) as integers (1, 0) and None values as an empty string ('').
                    </p>

                    <p> DataStore also allows for storing some more complex data structures.
                    The functions add_flag(), has_flag(), get_flag(), remove_flag() allow setting multiple values (flags) for a single key.
                    For example:<br>
                    <span class='api_inline'>save.add_flag('visited_places', 'beach')</span><br>
                    <span class='api_inline'> save.add_flag('visited_places', 'school')</span><br>
                    <span class='api_inline'> save.add_flag('visited_places', 'cinema')</span><br>
                    <span class='api_inline'>if save.has_flag('visited_places', 'beach'): has_been_to_beach(True)</span> <br>
                    The flag functions are implemented using a set.
                    </p>
                    <p>One can also store and retrieve lists using set_list(), get_list(), append_list().
                    </p>

                    <p>API:</p>
                    <div class='api'>
                        An instance of the DataStore class needs to be created before one can use any of its functions:<br>
                        <span class='api_def'>save = DataStore(<span class='api_num'>'save'</span>)</span><br><br>
                        <span class='api_def'>save.add_item</span>(name, value='')
                            <div class='api_doc'>Set name to value, same as self[name]=value</div>

                        <span class='api_def'>save.set_list</span>(key, input_list)
                        <div class='api_doc'>Stores the input_list as a string</div>

                        <span class='api_def'>save.get_list</span>(name)
                            <div class='api_doc'>Returns a value as if it was a list</div>

                        <span class='api_def'>save.append_list</span>(name, value)
                            <div class='api_doc'>Appends an item to a list stored using set_list(). Creates a new list if needed</div>

                        <span class='api_def'>save.del_from_list</span>(list_name, value)
                            <div class='api_doc'>Remove an item from a list stored using set_list()</div>

                        <span class='api_def'>save.is_empty</span>()
                            <div class='api_doc'>Returns True if there are no keys in the db</div>

                        <span class='api_def'>save.items</span>()
                            <div class='api_doc'>Returns an iterator over the key and values (same as dict)</div>

                        <span class='api_def'>save.clear</span>(subprefix=<span class='api_num'>None</span>)
                            <div class='api_doc'>Removes keys and values. If subprefix is not empty only removes keys that starts with subprefix</div>

                        <span class='api_def'>save.add_flag</span>(key, value)
                            <div class='api_doc'>Adds a flag to a key name.
                            Use has_flag() to check if the flag has been set.</div>

                        <span class='api_def'>save.has_flag</span>(key, value)
                            <div class='api_doc'>Checks if value flag has been set under the key name</div>

                        <span class='api_def'>save.get_flags</span>(key)
                            <div class='api_doc'>Returns a list of flags set under the key name.</div>

                        <span class='api_def'>save.remove_flag</span>(key, flag)
                            <div class='api_doc'>Removes a flag</div>

                        <span class='api_def'>save.remove</span>(*keys)
                            <div class='api_doc'>Removes a key(s) from the DB</div>

                        <span class='api_def'>save</span>[key] = value
                            <div class='api_doc'>Sets the value under the key name (same as dict)</div>

                        <span class='api_def'>save.key</span> = value
                            <div class='api_doc'>Sets the value under the key name (same as save[key] = value). </div>

                        <span class='api_def'>save.key</span>
                            <div class='api_doc'>Returns the value under the key name (same as save[key]). If 'key' is not in the DataBase it will return 0. You can use this to increment values that don't exist eg. save.something += 7 </div>

                        <span class='api_def'>save</span>[key]
                            <div class='api_doc'>Returns the value stored under the key name (same as dict)</div>

                        <span class='api_def'>key</span> <span class='api_num'>in</span> save
                            <div class='api_doc'>Returns True if key is in save (same as dict)</div>
                    </div>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='node'>Plot Node (node)</h2>
                <article>
                    <p> A Plot Node (or just node for short), is the basic, atomic part of the games plot.
                    Or in other words - it defines what is shown in the game window and knows what node to show next (how to traverse the node graph).
                    </p>
                    <p> All nodes have names and each node name must be unique (there can't be two nodes with the same name).
                    The nodes themselves are just collections of optional key - value pairs (that means a node can theoretically by just a name).
                    </p>
                    <p>
                    The keys in a node have special meanings and are made to help in writing common tasks and actions without the need of writing custom Python code for each node.
                    </p>
                    <h3>name</h3>
                    <p>
                    This is the unique identifier. Each node must have one, and each name must be unique.
                    </p>
                    <h3>next</h3>
                    <p>
                    For 'normal' nodes this points to the next node that will be shown one the user clicks to advance.<br>
                    The value should be the name of an existing node.<br>
                    For nodes that show any kind of special interface (shops, wardrobe) the game will advance to the next node once that interface is closed.<br>
                    Nodes with branches, choices or jumps should not have a next value.
                    </p>
                    <h3>pc</h3>
                    <p>If this key exists, upon visiting the node the PC avatar will be shown.<br>
                    The value defines what facial expression will be used for the PC.
                    </p>
                    <h3>txt</h3>
                    <p>This is the text displayed upon visiting the node. If a node has a next node defined it should also have something under the txt key</p>
                    <p>The value may be interpreted as a Python f-string if there are any curly brackets in the text ('{' and '}'). For example:<br>
                    I have {save.money} dollars in my pocket.<br>
                    or<br>
                    I have {str(save.money)+'dollars in my pocket' if money>0 else 'nothing!'}
                    </p>
                    <p> Because of the way this feature is implemented special care must be taken when using ' and " symbols.
                    You might need to replace ' with ` in some words (eg write can`t not can't) - the game will reverse this and players will still see "can't".<br>
                    You might not want to use manual line breaks as the text is evaluated per line.<br>
                    It is advisable to check if the text is evaluated correctly each time you use this feature. <br>
                    It is not recommended to add functions with side effects to the evaluated text (use cmd for that).
                    </p>
                    <h3>npc</h3>
                    <p>
                    If this key exists, a NPC image will be shown for this node. The value is the url for the image to use.
                    </p>
                    <h3>img</h3>
                    <p>
                    If this key exists, a background image will be shown for this node. The value is the url for the image to use.
                    </p>
                    <h3>eval_jump_to</h3>
                    <p>
                        If this key exist, its value will be evaluated (using the Python eval() function) and the value returned will be used as a node name to jump to.<br>
                        For nods that have a eval_jump_to value only the img and cmd key are used - everything else is ignored.<br>
                        The value of eval_jump_to is not evaluated by the editor and it is commonly used as a way to introduce discontinuity in the plot graph (so that only some and not all nodes are show in the preview).
                    </p>
                    <h3>cmd</h3>
                    <p>This key holds a list of commands (Python statement) to be executed.
                    They are executed in the order they appear and before any other changes to the game window are made (before the background image is changed, and before pc and npc images are shown).
                    </p>
                    <h3>choice</h3>
                    <p>Choices are explained in a later chapter. This key holds a list of lists where each outer list represents a choice that the player can make and each inner list has the condition, label and target node name.
                    </p>
                    <h3>branch</h3>
                    <p>Branches are explained in a later chapter. This key holds a list of lists where each outer list represents a choice that the player can make and each inner list has the condition, and target node name.
                    </p>
                    <h3>The Editor:</h3>
                    <img src='manual_img/normal_node.png'>
                    <p>When using the editor (dev/plot_edit.html) the currently selected nod is always displayed on the right side of the window.
                    Editing a node is just a matter of filling in the form and/or clicking on some buttons.
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='plot'>Plot Graph (plot)</h2>
                <article>
                    <p> The plot graph is the collection of all the plot nodes and their connections.
                    It is stored as a JavaScript object in the file data/plot.txt and the dev/plot_eitor.html is the recommended way to edit it as it shows how the nodes are connected (using arrows and colors) and also gives some hints about the content of the nodes using symbols (hovering over them shows even more informations). This is how the plot looks in the editor:
                    </p>
                    <img src='manual_img/plot_graph.png'>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='choice'>Choice</h2>
                <article>
                    <p>
                        A Choice is the basic way in which a player can interact with the game. From the players perspective
                        a choice node presents itself as one or more buttons in the game window and clicking on any one of them
                        moves the plot forward in a different direction (or sometimes it's an illusion and all choices lead to the same outcome.
                    </p>
                    <p>
                        From the creators point of view a choice can have multiple entries and each one has 3 elements:
                    </p>
                    <h3>Condition</h3>
                    <p>
                    	A choice condition is a Python expression that needs to evaluate to either True or False (or return a 
                    	truthful value, like 1 or 0, None, ""). The expression is evaluated at runtime, when the player reaches
                    	the choice node and if its return value is True the choice is presented to the player (in the form of a button).
                    </p>
                    <p>
                    	It is important that at least one condition in a choice node always evaluates to True, else the player
                        might get stuck (softlocked) without any option to progress the story.
                    </p>
                    <p>
                    	If a choice should always be visible to the player, one should write True or 1.
                    </p>
                    <h3>Label</h3>
                    <p>
                    	The label is simply the text on the choice button.
                    </p>
                    <p>
                    	While the game can handle relatively long labels, the text shouldn't be needlessly long.
                    </p>
                    <h3>Target</h3>
                    <p>
                    	Target is the name (id) of the plot node where the game will jump to when the player clicks on the particular choice.
                    </p>
                    <p>
                        Choice as seen in game:
                        <img src="manual_img/in_game_choice.webp">
                        Choice node in Plot Editor:
                        <img src="manual_img/choice.png">
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='branch'>Branch</h2>
                <article>
                	<p>
                		A branch is another way to control the flow of the plot. Unlike a choice, a branch offers the player no 
                		interaction and selects the next node based on the conditions programmed by the game author.
                	</p>
                	<p>
                		Just like the choice node a branch has target and  condition fields, but no labels. A choice node 
                		also shouldn't have any text because as soon as the player reaches a branch node the conditions
                		are evaluated and the game jumps to a new node.
                	</p>
                	<p>
                		A branch node can also be used to execute commands.
                		In some cases you would need to wrap commands using 
                		the execute_once() wrapper in case the player saves at 
                		the particular node and the commands get executed 
                		each time the game is loaded. 
                	</p>
                	<p>
                		The game will instantly jump to a target node (after executing the commands), 
                		if there is just one entry in a branch node (preferably
                		with a True condition), effectively turning the node invisible
                		to the player and adding a safe place where the author can put commands 
                		without the fear of exploits.
                	</p>
                	<h3>Condition</h3>
                	<p>
                		A branch condition is a Python expression that needs to evaluate to either True or False (or return a 
                    	truthful value, like 1 or 0, None, ""). The expression are evaluated at runtime, in the order they appear
                         in the plot graph (from top to bottom, in the editor). If the first entry evaluates to False, that entry is skipped
                         and the next entry is evaluated. This process is repeated until a condition evaluates to True (at least one conditions
                         should always evaluate to True!).
                	</p>
                	<p>
                		A special value <span class='api_inline'>random_branch</span> can be used in place of a condition. 
                		If it's present, the game will select one of the branches at random. This special mechanism expects all 
                		of the entries in a branch node to have the random_branch condition or none at all. The games makes some behind the 
                		scene manipulations such that the same target node won't be selected twice in a row or even again until all other 
                		nodes have been visited. It's not purely random.
                	</p>
                	<h3>Target</h3>
                	<p>
                		Target is the name (id) of the node where the game will jump
                        to once a condition is evaluated to True.
                	</p>
                    <p>                        
                        Branch node in Plot Editor:
                        <img src="manual_img/branch.png">
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='jump'>Jump</h2>
                <article>
                	<p>
                		Jump is another way to control the flow of the plot. 
                		Unlike choice and branch, jump has only one field - the 'eval_jump_to'.
                	</p>
                	<p>
                		Like with choice and branch the python expression in the evel_jump_to field 
                		gets evaluated at runtime when the player reaches the jump node, but the key 
                		difference is that the expression must return a valid node name (id).
                	</p>
                	<p>
                		While a jump node can be used for all sorts of advanced shenanigans, it's primary use is to 
                		introduce gaps in the plot editor. The editor will not evaluate the provided expression
                		and will not draw any nodes leading away from a jump node.
                	</p>
                	<p>
                		It is strongly advised to put jump nodes at every plotline end to minimize the amount 
                		of nodes displayed at one time, especially when having multiple, concurrent plotlines.
                	</p>
                	<p>
                		To make a 'static' jump to another node from a jump node just type in the name of the target node in quotes 
                		(eg. "some_fun_node" or 'some_fun_node').
                	</p>
                	<p>                        
                        Jump node in Plot Editor:
                        <img src="manual_img/jump.png">
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='cmd'>Command (cmd)</h2>
                <article>
                	<p>
                		Commands are snippets of code (Python expressions), executed when the player reaches the node and one node 
                		can have multiple commands.
                	</p>
                	<p>
                		Commands are executed in sequence, in the order they appear in the plot node. They are executed before anything 
                		else - before images are shown, before choice or branch conditions get evaluated, before jumps are made.
                	</p>
                	<p>
                		It is important to note that commands get executed each time a node is visited - this includes situations 
                		where the player loads a game. To prevent this behavior one can use a 'invisible' branch node with just one branch 
                		(as described <a href='#branch'>in the branch section</a>) or use the <span class='api_inline'>exec_once()</span>.
                	</p>
                	<p>
                		The <span class='api_inline'>exec_once()</span> wrapper keeps track of what commands where executed for a 
                		particular node and prevents commands from being executed again, if the node has been already visited by 
                		the player. Note: exec_once() require the command to be passed as a string eg. exec_once('save.money+=100')
                		
                	</p>
                	<p>
                		A full list of commands can be found both at the end of this document as well as in the editor (under the API tab).
                		
                	</p>
                	<p>
                		Details on how to write a valid Python expression are beyond the scope of this document. Use Google to 
                		find a tutorial about Python if you need further help writing Python code.
                	</p>
                    <p>                        
                        cmd in Plot Editor:
                        <img src="manual_img/cmd.png">
                        Auto-hints for cmd in Plot Editor:
                        <img src="manual_img/hints.png">
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='filter'>Filter</h2>
                <article>
                	<p>
                		Filter refers to a SVG filter applied to both PC and NPC images. These allow to change the appearance
                		of these elements at runtime without the need to make multiple images.
                	</p>
                	<p>
                		By default only 2 filters are provided with the engine 'default' and 'night'. The first one only 
                		draws a drop shadow around the sprites and the later also uses a color matrix to tint the sprites blue.
                	</p>
                	<p>
                		To change the filter use either <span class='api_inline'>svg_filter('default')</span> or 
                		<span class='api_inline'>svg_filter('night')</span> commands (in a nodes cmd).
                	</p>
                	<p>
                		The filter will not automatically switch back to the default state, so always make sure 
                		to switch back when you are done using a non-default filter.
                	</p>
                	<p>
                		Custom filters can be added, one just needs to add a filter element inside a svg tag and give it 
                		a unique id. That id can later be used in the svg_filter() function. Details on how to write 
                		a svg filter are beyond the scope of this document.
                	</p>
                    <p>
                        PC with 'default' filter:
                        <img src='manual_img/svg_filter_def.webp'>
                        PC with 'night' filter:
                        <img src='manual_img/svg_filter_night.webp'>
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='overlay'>Overlay</h2>
                <article>
                	<p>
                		Overlay is a image (or effect) displayed on top of the background image and both PC and NPC sprites.
                	</p>
                	<p>
                		To add an overlay to a scene (node) use the <span class='api_inline'>overlay_img()</span>command.
                	</p>
                	<div class='api'>
                		<span class='api_def'>overlay_img</span>( img_url=<span class='api_num'>None</span>, img_class=<span class='api_num'>'overlay_blend_screen'</span>, clear=<span class='api_num'>True</span> ):
                        <div class='api_doc'>
                         	img_url - the url (path) to the image to be displayed<br>
                         	if img_url is None - all overlayes will be cleared (removed)<br>
                         	img_class - the CSS class for the overlay element<br>
                         	clear - if clear is True all other overlays will be removed<br>
                        </div>
                	</div>
                	<p>
                		Multiple overlays can be added one on top of another, just pass <span class='api_inline'>clear=False</span>
                		to keep multiple overlays on the screen when adding overlay layers.
                	</p>
                	<p>
                		The img_class can be used to create various effects. Rain, fog, smoke, moving background, disco lights to name a few.
                		The details on how to use CSS to achive such effects are beyond the scope of this document.
                	</p>
                	<p>
                		Overlays are not cleared automatically, so just like with filters, one needs to remember to 
                		manually clear a overlay once it is not needed. To clear all overlays just call 
                		<span class='api_inline'>overlay_img()</span> with no arguments.
                	</p>
                	
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='autosave'>Autosave</h2>
                <article>
                    <p>
                        The engine provides an autosave feature. Whenever the player visits a node, the game checks if a 
                        autosave flag has been set on the node (by default, the Plot Editor sets this flag on all nodes),
                        and saves the name of the current plot node along with some extra informations (last know pc stat, npc, 
                        image, etc).
                    </p>
                    <p>
                        The game also stores a save version, this is meant to help in the event of errors, where some 
                        extra steps are needed when loading from an older (bugged) version. The seve version for new saves is first 
                        set in <span class='api_inline'>init_new_save()</span> and later updated whenever the player loads a game 
                        (in the <span class='api_inline'>restore_last()</span> function).
                    </p>
                    <p>
                        If you need to make your own contingency procedure for loading older version saves look to the implementation of the 
                        <span class='api_inline'>restore_last()</span> function.
                    </p>
                </article>
            <a href='#top'>[Back to top]</a>
             <h2 id='rollback'>Rollback</h2>
                <article>
                    <p>
                        Rollback is a feature that allows the player to move back to a previous choice and try different
                        paths. 
                    </p>
                    <p>
                        Each node only holds informations on where to go next and procedures (commands) on what
                        to do once the node is reached. In many cases the commands executed upon reaching a node 
                        cannot be easily reversed - for example, a simple command like 
                        <span class='api_inline'>save.something=7</span> could be impossible to reverse as we have no 
                        informations about the previous value of 'save.something'.
                    </p>
                    <p>
                        The rollback feature is implemented using somke and mirrors. Whenever the player reaches a choice node,
                        copies of the current save, inventory and quest DataStore are made and when the player decides he wants to 
                        roll back to his last choice, these copies replace the current save, inventory and quest. It's an automated 
                        quicksave.
                    </p>
                </article>
            <a href='#top'>[Back to top]</a>
            <h2 id='modal'>Modal Screens</h2>
                <article>
                	<p>
                		A modal UI widget is one that blocks access to all other UI elements, it is usually a 
                		dialog box or pop-up.
                	</p>
                	<p>
                		The engine has some helper functions that make it easy to create custom modal dialog prompts, 
                		but it should be noted that this is an advanced feature and should not be used lightly, as it blocks 
                		the player from accessing the game controls.
                	</p>
                	<p>
                		Creating a modal usually requires to provide a list of html elements and since there is no convenient way 
                		to do that from within a nodes cmd, it is not recommend to create modal popups using the cmd interface.
                	</p>
                	<div class='api'>
                		<span class='api_def'>_show_modal</span>( header_txt, body_elements, ok_cmd, cancel_cmd=<span class='api_num'>None</span>, ok_txt=<span class='api_num'>'OK'</span>, cancel_txt=<span class='api_num'>'CANCEL'</span> ):
                            <div class='api_doc'>
                            	header_txt - the text displayed in the header of the popup <br>
                            	body_elements - a list of html DOM elements to be added to the popup<br>
                            	ok_cmd - the command executed when the player clicks the ok button (as a string)<br>
                            	cancel_cmd - the command executed when the player clicks the cancel button (as a string)<br>
                            	if cancel_cmd is None, clicking the cancel button will only hide the modal<br>
                            	ok_txt - text label visible on the ok button<br>
                            	cancel_txt - text label visible on the cancel button<br>
                            </div>
                		    <span class='api_def'>_show_modal_input</span>( text, default_value, ok_cmd ):
                            <div class='api_doc'>
                             Show a modal dialog box with ok/cancel buttons and a text input box<br>
                             The input field has a id of 'modal_input' if one needs to check what the player typed in.<br>
                             default_value - the default value present in the input field<br>
                             ok_cmd - the command executed when the player clicks the ok button (as a string)<br>
                            	
                            </div>
                	</div>
                    <p>
                        Modal example as seen in-game:
                        <img src="manual_img/modal.webp">
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='quests'>Quests</h2>
                <article>
                    <p>
                        Quests refer to tasks that the player is given. They are visible to the player as a to-do list, 
                        and it's up to the game author to best decide how and when to update this quest-log.
                    </p>
                    <div class='api'>
                        <span class='api_def'>set_quest</span>( quest_name, quest_text=<span class='api_num'>None</span> ):
                        <div class='api_doc'>
                        quest_name - the internal name (id) of the quest. If the name was used previously, this will override the 
                        quest text. If it's a new name/id - a new entry in the quest log will be created.<br> 
                        quest_text - the text visible to the player. If set to None the questlog entry for this quest_name 
                        will be removed. <br>
                        </div>
                    </div>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='clothes'>Clothes</h2>
                <article>
                    <p>
                        Clothes are a visual representation of what the PC is wearing. It the default setup only the 
                        Player Character is dynamic and capable of wearing clothes.
                    </p>
                    <p> Slots are used to determine what the PC can wear at the same time, in the default configuration these are:
                    </p>
                    <ul>
                        <li>accessory</li>
                        <li>top</li>
                        <li>bottom</li>
                        <li>underwear_top</li>
                        <li>stockings</li>
                        <li>underwear_bottom</li>
                    </ul>
                    <p>The player can only have one item in any of the slots and each piece of clothing can only occupy one slot 
                    (even if visually they take up multiple slots - like a dress covering the body from neck to knee).
                    </p>
                    <p> 
                    Clothes are drawn in reverse order so first underwear_bottom, then stockings, underwear_top, bottom, top and finally accessory. 
                    </p>
                    <p>
                        For example if the PC has an item is both underwear_bottom and bottom slots - the item in underwear_bottom will be 
                        drawn first and on top of that the item from the bottom slot will be drawn.
                    </p>
                    <p> 
                        It is important to note that 'no item' is also a clothing item in the clothing system, so you may need to 
                        create blank items for every slot with no images.
                    </p>
                    <p>
                        To help determine what kind of clothing the Player Character is wearing a tag system is used.
                    </p>
                    <p>
                        Every clothing item can have a list of tags associated with it, some of them may have a special use or 
                        meaning, but in most cases it's up to the author to give these tags a meaning.
                    </p>
                    <p>
                        The function <span class='api_inline'>get_equipped_tagset()</span> can be used to check what tags 
                        the currently worn clothes have.
                    </p>
                    <p>
                        Because the first game developed using the Plotato engine was a female protagonist visual novel with strong 
                        sexual themes, the engine has an inherent sluttiness rating system. The details on how exactly that 
                        system works are complicated and will probably need a few paragraphs all to themselves - for now it's
                        enough to say that such a system exists and can be easily removed or disabled if needed.
                    </p>
                    <p>
                        The engine provides a shop and wardrobe interface that lets the player decide what he/she wants to wear (see 'Shops' below).
                    </p>
                    <p>
                        The <span class="api_inline">set_clothes()</span> function can be used to give and put on clothes 
                        on the player avatar. <span class="api_inline">give_clothes_by_tag(tag)</span> can be used to give 
                        multiple items at once, but the preferred way to add and remove items is by using the inventory DataStore.
                    </p>
                    <p>
                        <span class="api_inline">inventory.add_item('some_item_name')</span> will add 'some_item_name' to the players inventory (without equipping it) and <span class="api_inline">inventory.remove('some_item_name')</span> will remove the 'some_item_name' item (without un-equipping it, so never remove items in use).
                    </p>
                    <h3>API:</h3>
                    <div class="api">
                        <span class='api_def'>get_equipped</span>( tag=<span class='api_num'>None</span>, slot=<span class='api_num'>None</span>, exclude_tag=<span class='api_num'>'nude'</span> ):
                            <div class='api_doc'>
                             Returns a list of equipped items <br>
                            if tag is not None only the items with the tag get returned<br>
                            if slot is not None only the (one) item in the slot is returned (if any)<br>
                            no item that has the 'exclude_tag' tag will be returned<br>
                            </div>

                            <span class='api_def'>get_item_name</span>( item_id, *args ):
                            <div class='api_doc'>
                             Returns the name or names of the given item or items <br>
                            Note: Parts of the names in parenthesis will be dropped e.g 'Shirt (pink)' -> 'Shirt<br>
                            For multiple items the names will be comma separated.<br>
                            </div>

                            <span class='api_def'>give_clothes_by_tag</span>( tag ):
                            <div class='api_doc'>
                            Give all clothes that have the given tag 
                            </div>

                            <span class='api_def'>count_clothes_by_tag</span>( tag, eqquiped_only=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns the number of items the player has with the given tag <br>
                            if eqquiped_only is True, it checks only equipped items.
                            </div>

                            <span class='api_def'>has_clothes_by_tag</span>( tag, eqquiped_only=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns True if the player has any items with the given tag<br>
                            if eqquiped_only is True, it checks only equipped items.
                            </div>

                            <span class='api_def'>strip_nude</span>(  ):
                            <div class='api_doc'>
                            Takes of all the clothes
                            </div>
                            <span class='api_def'>set_clothes</span>( clothes, *args, **kwargs ):
                            <div class='api_doc'>
                            Gives and equips all the clothes. Additional clothes can be passed
                            as positional arguments or clothes can be a list <br>
                            If multiple items in the list share the same slots the last one will be used.<br>
                            No items are striped before updating the equipment.<br>
                            Also shows the PC avatar/paperdoll if show_pc (key-word-argument) is True
                            </div>
                       
                            <span class='api_def'>update_current_clothes_list</span>(  ):
                            <div class='api_doc'>
                             Update the current clothes list
                            </div>

                            <span class='api_def'>restore_clothes</span>(  ):
                            <div class='api_doc'>
                            Restore previously saved clothes (from using update_current_clothes_list())
                            </div>
                          
                            <span class='api_def'>is_exposed</span>( test_expo, logic=<span class='api_num'>'any'</span>, current_expo=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns True/False depending on current clothes and the given test_expo. <br>
                            Use the values from the EXPO eg.:<br>
                            test_expo=EXPO.PUSSY+EXPO.PART_BOOBS<br>
                            if logic == 'any': returns True if at least one bit matches<br>
                            if logic == 'all': returns True if all bit match<br>
                            if logic == 'some': uses RNG, returns True more often if more bits match
                            </div>

                            <span class='api_def'>get_exposure</span>( tags=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns a int (bitmask) used for checking nudity
                            </div>

                            <span class='api_def'>match_clothes</span>( test_set ):
                            <div class='api_doc'>
                             Returns the % match between the current clothes and the test_set
                            as a float in 0.0, 1.0 range.
                            </div>

                            <span class='api_def'>check_uniform</span>( slots, tags, current_items=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Check if the clothes_set is a valid uniform.<br>
                            A uniform is valid if all items in 'slots' have 
                            at least one of the tags in the 'tags' set.
                            </div>

                            <span class='api_def'>get_underwear</span>(  ):
                            <div class='api_doc'>
                            Returns a list of currently equipped underwear types, one of:<br>
                            ['bra', 'panties']<br>
                            ['bra']<br>
                            ['panties']<br>
                            []
                            </div>

                            <span class='api_def'>get_equipped_tagset</span>(  ):
                            <div class='api_doc'>
                             Returns a set with the tags of the currently equipped clothes
                            </div>            

                            <span class='api_def'>get_clothes_stats</span>( clothes_list ):
                            <div class='api_doc'>
                             Returns a tuple that is the slutiness value of the clothes in the clothes_list
                            and the name of the uniform type<br>
                            eg. (7, 'School Uniform')
                            </div>
                    </div>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='shops'>Shops</h2>
                <article>
                    <p>
                        Shops are basically pre-defined list of clothing items. The prices and other stats of items are 
                        defined in data/items.txt so the data/shops.txt file only tells the game what the shops sell.
                    </p>
                    <p>
                        To open a shop (show the player the shop ui) one needs to call the 
                        <span class="api_inline">shop(shop_id='some_shop')</span> function. 
                    </p>

                    <p>
                        The shop and wardrobe system share some of the UI elements, with the difference being that the
                        wardrobe screen has player customizable outfits (sets of clothes) where the shop would have a shopping cart panel. 
                    </p>
                    <p>
                        The function <span class="api_inline">change_clothes()</span> that brings up the wardrobe UI 
                        is just a wrapper for <span class="api_inline">shop(shop_id=None)</span>.
                    </p>
                    <p>
                        The engine takes care of remembering what item are bough and sold even if the player closes the game mid shopping. It will also prevent the player from leaving the shop if the value of the items 
                        in the shopping cart exceeds the player's available money.  
                    </p>
                    <div class="api">
                        <span class='api_def'>change_clothes</span>( tag_set=<span class='api_num'>None</span>, enforce_stats=<span class='api_num'>1</span>, limited=<span class='api_num'>False</span>, loopback=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Opens the wardrobe UI letting the player change clothes. Alias for shop with no items.<br>
                             tag_set - if it's not None, only items that have at least one tag from the tag_set are shown <br>
                             enforce_stats - if False, the player will be able to wear any combination of clothes regardless of stats. <br>
                             limited - if True, the available items will be limited to items from the current clothes list  (saved using update_current_clothes_list() or auto-saved when the player closes the shop ui)<br>
                             loopback - if True, the game will return to the plot node shown before the shop opened (used for cheats/debug)<br>
                            </div>

                        <span class='api_def'>shop</span>( shop_id=<span class='api_num'>None</span>, tag_set=<span class='api_num'>None</span>, enforce_stats=<span class='api_num'>1</span>, buyback=<span class='api_num'>False</span>, discount=<span class='api_num'>None</span>, limited=<span class='api_num'>False</span>, loopback=<span class='api_num'>False</span> ):
                        <div class='api_doc'>
                         Show the shop/wardrobe screen. <br>
                            shop_id is the name of the shop (see data/shops.txt) or None (for wardrobe)
                            tag_set - if it's not None, only items that have at least one tag from the tag_set are shown <br>
                             enforce_stats - if False, the player will be able to wear any combination of clothes regardless of stats. <br>
                             buyback - if True, the PC can sell all her clothes to the shop, else only the items in the current shopping session (in the shopping cart) can be returned.<br>
                             discount - all shop prices are multiplied by 'discount' (rounded down)<br>
                             limited - if True, the available items will be limited to items from the current clothes list  (saved using update_current_clothes_list() or auto-saved when the player closes the shop ui)<br>
                             loopback - if True, the game will return to the plot node shown before the shop opened (used for cheats/debug)<br>
                        </div>
                    </div>
                    <p>
                        Wardrobe UI in-game:
                        <img src="manual_img/wardrobe.webp">
                        Shop UI in-game:
                        <img src="manual_img/shop.webp">
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='map'>Map</h2>
                <article>
                    <p>
                		The map system uses a static background image for the map and dynamic markers/point of interest (poi).
                		The player can move freely between the POIs on the map by clicking on any of the markers while the 
                		map screen is visible.
                	</p>
                	<p>
                		The map offers map events (random encounters) that can trigger when moving around the map, either
                         based on chance or custom trigger conditions (see 'Map Events' section below).
                	</p>
                	<p>
                		By default the map expects 3 images for the background - one for the day, one for the night and one 
                		for dusk and dawn (img/map.webp, img/map_dark.webp and img/map_dusk.webp).
                	</p>
                	<p>
                	    To take the player to the map screen use the <span class="api_inline">show_map()</span> function. 
                	    It is recommend that a node using this command has no images, pc, npc nor a next node defined.
                	</p>
                	<p>
                	    In cases where the author wants to limit the available choice of POIs or show special POIs that would normally 
                	    be hidden, one can use the additional parameters in the <span class="api_inline">show_map()</span> function.
                	</p>
                	<div class="api">
                	    <span class='api_def'>show_map</span>( poi_list=<span class='api_num'>None</span>, show_known=<span class='api_num'>True</span> ):
                        <div class='api_doc'>
                         Shows the map screen updates the map pins POI<br>
                         poi_list - None or a list/tuple of POI names to be shown on the map<br>
                         show_known - if False, the map will only display the POIs listed in poi_list<br>
                        </div>
                            
                	</div>
                	<h3>POI</h3>
                	<p>
                		The points of interest (POI) are stored in data/map_poi.txt, where each POI has it's label, icon,
                		target (plot node name/id), name and coordinates defined.
                	</p>
                	<p>
                	    POIs are by default hidden to the player and need to be manually added to the list of known 
                	    places before the player will be able to see any of them. This is best done using the 
                	    <span class="api_inline">add_poi('poi_name')</span> function, where the poi_name is the name of 
                	    the poi as defined in data/map_poi.txt. 
                	</p>
                	<p>
                	    If needed POIs can also be removed (or at least hidden from the player) using the
                	    <span class="api_inline">del_poi('poi_name')</span> function.
                	</p>
                	
                    <p>
                        Map as seen in-game:
                        <img src="manual_img/map.webp">
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='events'>Map Events</h2>
                <article>
                    <p>
                        In most cases, when a player clicks on a map marker the game will simply jump to the target plot node 
                        defined in data/map_poi.txt for that POI, but that may not always be true.
                    </p>
                    <p>
                        Before jumping to the target node the game first calls the
                        <span class="api_inline">_get_map_event(from_poi, target_poi)</span> function to check if there is a map event.
                        Depending on the version of the engine there may or may not be hardcoded map events that may send the player home 
                        if wondering late at night or without any pants on. When making Your own game You most likely need to at least 
                        look into the details on how that function is implemented.
                    </p>
                    <p>
                        In cases where You never want to trigger any map events when the player clicks on a map marker, you 
                        need to set up Your POIs in a specific way. If a POI target does not start with a 'map_' prefix all map 
                        events will be ignored whenever the player clicks on that POI.
                    </p>
                    <p>
                        Apart from the hardcoded events <span class="api_inline">_get_map_event(from_poi, target_poi)</span> 
                        may also return random events or dynamic map events.
                    </p>
                    <h3>Dynamic map events</h3>
                    <p>
                        Dynamic map events can be set at runtime using the 
                        <span class="api_inline">set_map_event( target, from_poi=<span class='api_num'>None</span>, target_poi=<span class='api_num'>None</span> )</span>
                        function. The 'target' argument must always be provided (it's the target node name/id), but both from_poi and target_poi are optional.
                    </p>
                    <p>
                        If just from_poi is provided the event will trigger when the player leaves that POI heading for any destination.
                    </p>
                    <p>
                        If just the target_poi is provided - the event will trigger when arriving at the given POI.
                    </p>
                    <p>
                        If both from_poi and target_poi are provided - the event will only trigger when the player 
                        moves from the from_poi to the target_poi.
                    </p>
                    <p>
                        There can be multiple map events set, but obviously only one can trigger at any given time. Their priority is as followed:
                        <ol>
                            <li> Event with no from_poi and no target_poi</li>
                            <li> Event with from_poi equal to current location and no target_poi (happens as PC leaves a place) </li>
                            <li> Event with both from_poi and target_poi that match where the PC is going from and to (happens on route)</li>
                            <li> Event with no from_poi but with target_poi equal to where the player is going (happens when PC arrives)</li>
                        </ol>
                    </p>
                    <p>
                        Dynamic map events are always one-shot, as removed as soon as they are triggered. If the need arises to manually delete a event that didn't trigger yet - one can use the  
                        <span class='api_inline'>remove_map_event(target, from_poi=<span class='api_num'>None</span>, target_poi=<span class='api_num'>None</span>)</span>
                    </p>
                    <p>
                        The game checks for dynamic map events after checking the hardcoded events and before checking random events.
                    </p>
                    <h3>Random Map Events</h3>
                    <p>
                        Random map events can be defined in data/map_events.txt.
                    </p>
                    <p>
                        The value saved in <span class="api_inline">save.map_event_chance</span> determines how often 
                        random map events can happen. Any value between 0 and 100 are valid and 0 means never, 100 means always
                    </p>
                    <p>
                        When the engine decides that a random map event should happen, it takes the list of all possible events, 
                        removes the ones that don't match the current game state (wrong time of day, wrong from or to nodes, 
                        wrong clothes, failed custom conditions, etc) and picks one of the events at random, using the individual 
                        events chances as weights.
                    </p>
                    <p>
                        Each time a random event triggers it's weight(chance) gets reduced and so the more a event happens 
                        the less likely it is to happen again. There's also a mechanism that prevents the same event from 
                        triggering twice in a row.
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='time'>Time</h2>
                <article>
                    <p>
                        Time is internally stored as the number of hours from the start of the game.
                    </p>
                    <p>
                        Each in-game day is divided into 6 periods (time-of-day):
                        <ul>
                            <li>0 Night (00:00 - 03:00)</li>
                            <li>1 Morning (04:00 - 07:00)</li>
                            <li>2 Noon (08:00 - 11:00)</li>
                            <li>3 Midday (12:00 - 15:00)</li>
                            <li>4 Afternoon (16:00 -19:00) </li>
                            <li>5 Evening (20:00 - 23:00)</li>
                        </ul>
                    </p>
                    <p>
                        The in-game clock can be advanced by one or multiple hours or one can skip to a desired time-of-day.
                    </p>
                    <p>
                        Special care must be taken when advancing the clock to a specific time-of-day, as not to skip to the next 
                        day by accident (eg. skipping to noon when it's already midday or later could move you to the next day 
                        skipping over both night and morning).
                    </p>
                    <h3>API</h3>
                    <div class="api">
                        <br>CONSTANTS:<br>
                            <span class='api_def'>TIME.NIGHT</span> = <span class='api_num'>0 </span>      # 0-3 <br>
                            <span class='api_def'>TIME.MORNING</span> = <span class='api_num'>1</span>     # 4-7 <br>
                            <span class='api_def'>TIME.NOON</span> = <span class='api_num'>2 </span>       # 8-11 <br>
                            <span class='api_def'>TIME.MIDDAY</span> = <span class='api_num'>3</span>      # 12-15 <br>
                            <span class='api_def'>TIME.AFTERNOON</span> = <span class='api_num'>4</span>   # 16-19 <br>
                            <span class='api_def'>TIME.EVENING</span> = <span class='api_num'>5</span>     # 20-23 <br>
                            <br>
                            <span class='api_def'>TIME.MONDAY</span> = <span class='api_num'>0</span> <br>
                            <span class='api_def'>TIME.TUESDAY</span> = <span class='api_num'>1</span> <br>
                            <span class='api_def'>TIME.WEDNESDAY</span> = <span class='api_num'>2</span> <br>
                            <span class='api_def'>TIME.THURSDAY</span> = <span class='api_num'>3</span> <br>
                            <span class='api_def'>TIME.FRIDAY</span> = <span class='api_num'>4</span> <br>
                            <span class='api_def'>TIME.SATURDAY</span> = <span class='api_num'>5</span> <br>
                            <span class='api_def'>TIME.SUNDAY</span> = <span class='api_num'>6</span> <br>
                           <br>
                         <span class='api_def'>get_hour</span>(  ):
                            <div class='api_doc'>
                            Returns the current hour
                            </div>
                            <span class='api_def'>get_weekday</span>(  ):
                            <div class='api_doc'>
                            Returns the day of the week as an int
                            </div>
                            <span class='api_def'>is_weekday</span>( weekday ):
                            <div class='api_doc'>
                            Returns True if today is 'weekday
                            eg.: 'is_weekday(TIME.MONDAY)
                            To test if it's a 'work day' use 'not is_weekend()
                            </div>
                            <span class='api_def'>is_weekend</span>(  ):
                            <div class='api_doc'>
                             Returns True if it's SATURDAY, SUNDAY or FRIDAY AFTERNOON
                            </div>
                            <span class='api_def'>get_datetime</span>(  ):
                            <div class='api_doc'>
                             Returns (day, hour)
                            </div>
                            <span class='api_def'>get_day</span>(  ):
                            <div class='api_doc'>
                             Returns the current day number (starting from 0)
                            </div>
                            <span class='api_def'>is_time_of_day</span>( *time_of_day_list ):
                            <div class='api_doc'>
                            Returns True if the current time of day is in the time_of_day_list
                            eg: 'is_time_of_day(TIME.MORNING, TIME.NOON)
                            </div>
                            <span class='api_def'>is_day</span>(  ):
                            <div class='api_doc'>
                             Returns True if it's MORNING, NOON, MIDDAY, or AFTERNOON
                            </div>
                            <span class='api_def'>get_time_of_day</span>(  ):
                            <div class='api_doc'>
                             Returns the time of day as an int
                            </div>
                            <span class='api_def'>set_hard_datetime</span>( day, hour ):
                            <div class='api_doc'>
                            Set the in game time, ignoring everything
                            </div>
                            <span class='api_def'>get_day_name</span>( future_day=<span class='api_num'>0</span>, exact_day=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns the (string) name of the current day
                            if future_day is provided it returns the name
                            of the day future_day days away
                            </div>
                            <span class='api_def'>get_time_of_day_name</span>( use_in_at=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns the time of day as a string
                            </div>
                            <span class='api_def'>set_time_of_day</span>( time_of_day ):
                            <div class='api_doc'>
                             Sets the time of day, (usually) moving the time forward.
                            Note: The actual time is set to the first hour in the give time period,
                            this may turn the clock back by up to 3h!
                            eg. if it's 7AM in the morning and you call
                            set_time_of_day(TIME.MORNING) it will become 4AM

                            </div>
                            <span class='api_def'>progress_time</span>( amount=<span class='api_num'>1</span> ):
                            <div class='api_doc'>
                             Moves the in-game clock by amount hours (int),
                            also displays the current time/date in the status div
                            </div>   
                    </div>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='tce'>Time Critical Events</h2>
                <article>
                    <p>
                        Time Critical Events (TCE) are events that trigger at a pre-defined time, when the player travels using the map (or at some specially constructed plot nodes).
                    </p>
                    <p>
                        If a TCE is set, the in-game clock will not advance past the time when the event should happen (unless using set_hard_datetime() or manually changing save.time). 
                    </p>                   
                    <h3>Out of map node setup for TCE</h3>
                    <p>
                        If you're using the TCE system and have places in the node graph where time is skipped forward, but you don't return to the map screen afterward - you might want to set up some extra nodes that will check for time critical events after visiting a node that calls <span class="api_inline">progress_time()</span>.
                    </p>
                    <h3>Checking for events</h3>
                    <p>
                        Make a Branch node with one of the conditions being <span class="api_inline">get_tce() is not None</span>. If this condition is evaluated to True, you have a TCE to go to - but before pushing the player to the map screen, you might want to check if the event should maybe take place where the player currently is. 
                    </p>
                    <h3>Checking event destination</h3>
                    <p>
                        If you know that a TCE is schedule to happen now, you can check where it should take place and compare that to the current location: <span class="api_inline">get_tce(arg='map_poi') == 'some_poi_name'</span>. You can also use the save variable 'current_location', that gets updated each time the player moves via the map - of course if the player never moved via the map,
                        moved about using some other way, or had a random encounter while traveling - the 'current_location' may not always be reliable <span class="api_inline">get_tce(arg='map_poi') == save.current_location</span>.
                    </p>
                    <h3>Manual trigger</h3>
                    <p>
                        If you determined that the player already is where the event should happen, you can trigger the event using a jump node (eval_jump_to) with: <span class="api_inline">get_tce(arg='target')</span>
                    </p>
                    <h3>Clean up</h3>
                    <p>
                        TCE are not automatically removed if not triggered from the map, so always make sure that you call <span class="api_inline">remove_tce()</span> in the first plot node of the event. 
                    </p>
                    <h3>API:</h3>
                    <div class="api">
                         <span class='api_def'>set_tce</span>( target, day, hour, map_poi, map_redirect ):
                            <div class='api_doc'>
                             Set a Time Critical Event (tce) that will start on the given 'day' and 'hour'.<br>
                            'target' is the name of the plot node that the player will jump to.<br>
                            the event will trigger when moving via the map, the map_poi must be one of the known Points Of Interest. <br>
                            When the player clicks it at the right time ('day', 'hour') it will jump to the 'target' plot node. <br>
                            Clicking any other poi will jump to 'map_redirect' <br>
                            If a TCE is set, the in-game clock will never (normally) progress past day*24+hour,
                            until the event is resolved.<br>
                            Only 1 (one) TCE can be set for a given day, hour.
                            </div>

                            <span class='api_def'>remove_tce</span>( day=<span class='api_num'>None</span>, hour=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Removes (cancels) a TCE.<br>
                            Called automatically when a TCE is triggered from map.<br>
                            If day is None and hour is None the current time (save.time) is used                            </div>

                            <span class='api_def'>get_tce</span>( timestamp =<span class='api_num'> None</span>, arg =<span class='api_num'> None</span> ):
                            <div class='api_doc'>
                             Returns the list [target, day, hour, map_poi, map_redirect]
                            for a TCE with the given timestamp (day*24+hour) <br>
                            if timestamp is None - the current time (save.time) is used<br>
                            if arg is one of ['target', 'day', 'hour', 'map_poi', 'map_redirect'], the function will return just the one value<br>
                            if there is no TCE with the timestamp - returns None
                            </div>
                    </div>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='audio'>Audio</h2>
                <article>
                    <p>
                        The engine provides a way to play back audio using the browsers audio player.
                    </p>
                    <p>
                        The current implementation only allows to play one sound at a time and it is recommended to 
                        provide audio in mp3 format, because support for other audio formats varies from browser to browser.
                    </p>
                    <p>
                        While the volume can be changed programmatically, it is advised to let the end user decide at what volume to play to audio. 
                    </p>
                    <p>
                        Note: Some (if not all) browsers will not allow to play audio until the player interacts with the page (clicks a button), therefore it is impossible to automatically play background music on the first screen (main menu) when the game first loads.
                    </p>
                    <div class="api">
                        <span class='api_def'>music</span>( name, loop=<span class='api_num'>True</span> ):
                        <div class='api_doc'>
                        Alias for play_music(url='audio/'+name+'.mp3', loop)<br>
                        name - name of the audio file from 'audio/', without the extension.<br>
                        loop - if True, the sound will loop forever.
                        </div>

                        <span class='api_def'>stop_music()</span>
                        <div class='api_doc'>
                        Stops the currently playing music (if any)
                        </div>
                     
                        <span class='api_def'>play_music</span>( url=<span class='api_num'>None</span>, loop=<span class='api_num'>True</span> ):
                        <div class='api_doc'>
                        Play a music(.mp3) file using the browsers build-in player <br>
                        url - the url of the audio file to play <br>
                        loop - if True, the sound will loop forever. 
                        </div>
                    </div>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='tts'>Text to Speech (TTS)</h2>
                <article>
                    <p>
                        If run in a browser/operating system that provides Text-To-Speech capabilities (using the Web Speech API), the engine can perform text to speech synthesis.  
                    </p>
                    <p>
                        The TTS implementation is not designed with ease of access in mind. It will not read button labels, 
                        it will not read actor names, it will not give descriptions of scenes nor images - it will only read what the characters would say. 
                    </p>
                    <p>
                        TTS is designed so, that each actor in the game can have it's own distinct voice. Unfortunately 
                        there isn't one set of voices available on all systems, so if a player wants to use this feature, he needs to manually assign voices to all the actors in the game. 
                    </p>
                    <p>
                        The data file 'data/voices.txt' stores a list of known actors under the name 'known_voices'. For every item in that list the game will create a widget allowing the player to set a voice for that one actor. The widget will not display a name, but a small portrait to avoid potential spoilers. 
                        The game expects the portraits in 'img/portrait/' saved as .webp files with the name of the file identical to the name of the actor.
                    </p>
                    <h3>Actor names</h3>
                    <p>
                        The game expects the first line of any text in a txt field that ends with ':' to be a actor name eg. <span class='api_inline'>Some NPC:</span> - if such a pattern is detected, the game turns that first line into lowercase letter and strips any non-alphanumeric characters to create a internal representation of the actor name - using the previous example <span class='api_inline'>Some NPC:</span> would get turned into <span class='api_inline'>somenpc</span>. 
                    </p>
                    <p>
                        If there is a item on the 'known_voices' list in 'data/voices.txt' that matches the actor name as constructed above, then the game will synthesize text-to-speech using a voice that the player assigned to that actor. 
                    </p>
                    <h3>Speaker Alias</h3>
                    <p>
                        If there is no known voice that matches the actors name, the game checks another variable defined in 'data/voices.txt' - the 'speaker_alias'. 
                    </p>
                    <p>
                        'speaker_alias' is a dictionary that holds alternative actor names. If we had 'somenpc' in 'known_voices', but we also want a npc named <span class='api_inline'>Some Other NPC:</span> to also use that name, we would have to add <span class='api_inline'>'someothernpc':'somenpc', </span> to the 'speaker_alias' dictionary.
                    </p>
                    <h3>Default voice</h3>
                    <p>
                        If the game can't find a voice for the current blob of text, a default voice is used. That default voice is called 'default' and it also can be customized by the player (unless removed from the 'known_voices' list - do not remove 'default' from the 'known_voices' list). 
                    </p>
                    <p>
                        In-game TTS setup:
                        <img src="manual_img/tts_setup.webp">
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='mods'>Mods</h2>
                <article>
                    <p>
                        The engine allows for custom content mods to be loaded. 
                    </p>
                    <p>
                        Mods are Python scripts that are executed at the end of the game initialization. They are stored in the 'data/mods.txt' data file and can be loaded using the dev/mod_manager.html tool. 
                    </p>
                    <p>
                        Because of how Python works, mods can change anything and everything. Change functions, modify data, add or remove widgets etc.   
                    </p>
                    <p>
                        Mods can be potentially dangerous to the end user, but since the game is running in a browser provided sandbox - the risk is minimal. Mods can redirect to malicious sites or prompt the user to save executables to the hard drive, but can't do much without active user input or interaction.   
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h1 id='customizing'>Customizing Your Game </h1>
                <article>
                    <p>Before You start writing your own game You should
                       take a minute to customize a few elements in the
                       index.html file. All the places you need to edit
                       are marked with '#CHANGE_HERE' in a comments, so
                       even if the line numbers change in future version,
                       these elements should still be easy to find.
                    </p>
                    <h3>The HTML</h3>
                    <p>
                       The changes needed to make in the markup part of the
                       engine are quite simple and focused around credits
                       and copyright notices.
                    </p>
                    <p> You will most likely want to add your name or company
                        name to the page meta-data, copyright notice at the bottom,
                        change the title and perhaps add or change some buttons on the title screen.
                    </p>
                    <p> Here are some screens taken from a text editor showing
                        what to look for and what to change. Details on how to write
                        and modify HTML code is beyond the scope of this document.
                    </p>

                    <p>Meta-data. Add and/or change whatever you need.
                    <img src='manual_img/change_here1.png'>
                    </p>

                    <p>Game specific style sheet. If you have some custom css
                    (for example for overlay effects or animations) you can
                    add it to a separate file so as no to mess with the original engine
                    stylesheet. Deleting it and putting everything in one file also works.
                    <img src='manual_img/change_here2.png'>
                    </p>

                    <p>Game title. Self explanatory.
                    <img src='manual_img/change_here3.png'>
                    </p>

                    <p>The monetize div is meant to hold clickable buttons, that would take
                    the user to outside webpages or display some modal screen with extra info
                    on how to support the game creators. You can remove these if you don't
                    intend on using this feature or add your own. Note that you will need
                    to write your own CSS styling for your custom buttons and bind events
                    so that something happens when the user clicks on them - you'll see how a bit lower.
                    <img src='manual_img/change_here4.png'>
                    </p>

                    <p>The copyright notice is just a bit of texted displayed at the bottom of the page.
                    Here you can customize what it says. Note that by default the engine will add a
                    version number at the end.
                    <img src='manual_img/change_here5.png'>
                    </p>

                    <h3>Python</h3>
                    <p> Changes in the python script may be a bit more challenging,
                        but you don't need to know how to write a python program,
                        just how to change some letters.
                    </p>
                    <p>Data Storage. This is the interface for saving and loading game states from
                    the browsers memory (local storage). There's more info on this in
                    later parts of this document. On Chrome based browsers all games (and apps)
                    running locally (not from a web server) share the same space, so to
                    avoid one game (app) from overriding data from another we use a prefix
                    to store the data under a unique name. The default prefix is usually
                    'plotato_' but as show on the screen this may vary. Replace the string
                    'plotato_demo_' (or 'platoto_') with a prefix that will be unique to your game.
                    Remember to keep it between the quotation marks.
                    <img src='manual_img/change_here6.png'>
                    </p>

                    <p>Default values for new save. init_new_save() is a function that is (should) be
                    called when a player starts a new game. Here you should reset (clear) the
                    data in old saves and set default values for the rest of the game. The example
                    below shows how to set up things like starting date and time, money, items (clothes),
                    known places, etc.
                    <img src='manual_img/change_here7.png'>
                    </p>

                    <p>Here, on the first line you can see how the buttons in the monetize div (mentioned above)
                    are bound to functions. Or in other words - what happens when the user clicks
                    on any of them. doc['buymeacoffee'] tells the script that we want to do
                    something with a element with the id='buymeacoffee' and the rest of the line
                    defines what we want to do with it. You don't need to understand all of it,
                    just knowing it will open a URL (website) under the address 'https://www.buymeacoffee.com/sharkinahat'
                    is enough. To make your own button open the website you want just replace the URL (and/or element id).
                    <br><br>
                    The next few lines show how you can set up a modal (full-screen pop-up).
                    The details how a modal works are described further in this document.
                    <img src='manual_img/change_here8.png'>
                    </p>

                    <p>Title screen. This is the part of the script that defines what is shown when
                    the game starts. It has reasonable defaults, but if you want to name your
                    plot nodes differently or add other buttons on the title screen - here is the best place to do so.
                    <img src='manual_img/change_here9.png'>
                    </p>

                    <a href='#top'>[Back to top]</a>
                </article>

            <h1 id='dirs'>Directories Structure</h1>
                <article>
                	<p>
                		These are the basic files that the engine uses, along with a brief description of their purpose (in brackets).
                	</p>
                	<ul>
                		<li>audio (music/sounds)</li>
                		<li>
                			brython (Brython implementation)
                			<ul>
                				<li>brython.js</li>
                				<li>brython_modules.js</li>
                			</ul>
                		</li>
                		<li>data (data files)
                			<ul>
                				<li>items.txt</li>
                				<li>map_events.txt</li>
                				<li>map_poi.txt</li>
                				<li>mods.txt</li>
                				<li>plot.txt</li>
                				<li>shops.txt</li>
                				<li>supporters.txt</li>
                				<li>version.txt</li>
                				<li>voices.txt</li>
                			</ul>
                		</li>
                		<li>dev (developer tools)
                			<ul>
                				<li>bug_tool.html</li>
                				<li>item_editor.html</li>
                				<li>item_maker.html</li>
                				<li>make_datalist.py</li>
                				<li>mod_manager.py</li>
                				<li>plot_edit.html</li>
                				<li>shop_editor.html</li>
                			</ul>
                		</li>
                		<li>font (fonts)
                			<ul>
                				<li>fa-solid-900.ttf</li>
                				<li>monofonto.ttf</li>
                			</ul>
                		</li>
                		<li>img (images)
                			<ul>
                				<li>...</li>
                			</ul>
                		</li>
                		<li>mods (third party mods)</li>
                		<li>style (CSS stylesheets)
                			<ul>
                				<li>default.css</li>
                			</ul>
                		</li>
                		<li>index.html (main game file)</li>
                	</ul>
                    <a href='#top'>[Back to top]</a>
                </article>

            <h1 id='data'>Data Files</h1>
                <article>
                	<p>
                	    The engine makes use of a few data files, and while technically all of these files contain (or may contain) 
                	    code, we will refer to them as data.
                	</p>
                	<p>
                		The data files use a txt extension, but they all are in fact JavaScript source files. Because of 
                		the limitations of Brython, one can't (easily and reliably) read the content of arbitrary files, 
                		therefore the data is stored in easy to import JavaScript files.
                	</p>
                    <p>
                		The .txt extension is used because some browsers are funny about saving .js files
                	</p>
                	<h3>items.txt</h3>
                	<p>
                		This file stores the clothing in a dictionary named 'items'. It's data structure looks like this:
                	</p>
<pre class='api'>
 var items = {
    "item_id":{
         "name":"Some Item Name",
         "img":"img/pc/debug_sack.png",
         "slot":"top",
         "tags":['clothes_top', 'clothes_bottom', 'some_other_tag'],
         "slutty":0,
         "value":100,
         },
    "other_item_id":{
         "name":"Some Item Name",
         "img":"img/pc/debug_sack.png",
         "slot":"bottom",
         "tags":['clothes_bottom', 'some_other_tag'],
         "slutty":5,
         "value":10,
         },     
	};         
</pre>
                	<h3>map_events.txt</h3>
                	<p>
                		This file defines events that can occur randomly when traveling via the map.
                	</p>
<pre class='api'>
var map_events = [
    {'from':'', 'to':'', 'time_of_day':'', 'chance':0, 'slut_x':0, 'eval':'True', 'target':'', 'clothes': [] },

];                		
</pre>
                	<h3>map_poi.txt</h3>
                	<p>
                		This file defines all points of interest on the in-game map, including hidden ones.
                	</p>
                	
<pre class='api'>
//  ['label',              icon',  'target',          'name',           x,    y ]
//id:0                     1       2                  3                 4     5
var poi = [
    ['Explore the City ', 'f4d7',  'map_explore',     'explore',        1245,  88],
];                		
</pre>
                	<h3>mods.txt</h3>
                	<p>
                		This is a file automatically generated by the mod_manager.html and controls what 
                		third party mods are loaded by the game. It contains the source code of loaded mods 
                		and might not be very human-readable. 
                	</p>
                    <h3>plot.txt</h3>
                    <p>
                		The main data file containing the plot graph.
                	</p>
<pre class="api">
var notes = "";
var plot = {
    "pre_new_game" : {
        "txt" : "The game uses an auto-save system, starting a new game will {RED('ERASE ALL AUTO-SAVES')} (but not manual savefiles)! Do You want to start a new game? ",
        "no_save" : 1,
        "choice" : [["True", "Start New Game", "new_game"], ["True", "Cancel", "back_to_main"]],
        "cmd" : ["music('like_the_synth')", "parallax_imgs(('img/parallax/class_l0.webp', 'img/parallax/class_l1.webp', 'img/parallax/class_l2.webp'))"]
    },
    "new_game" : {
        "txt" : "Would You like to see a short tutorial going over the basics of the User Interface? ",
        "img" : "img/title/title_free.webp",
        "choice" : [["True", "Show Tutorial", "tutorial_1"], ["True", "Skip", "prologue_jump"]],
        "cmd" : ["init_new_save()"]
    }
};  
</pre>
                	<h3>shops.txt</h3>
                	<p>
                		This file lists what items are available in what shops.
                	</p>
<pre class="api">
var shops = {
    "dress_shop":[
        "dress_sun_lila",
        "cone_dress",
        "santa_micro_skirt"
        ],
    "other_shop":
        ["some_item",
        "pants"
        ]
    };        
</pre>
                	<h3>supporters.txt</h3>
                	<p>
                		This file contains the text for the 'credits' slideshow.
                	</p>
<pre class="api">                    
var credits = ['CREDITS',
                'CREATED BY:\nShark in a Hat',
                'STORY BY:\nShark in a Hat',
                'ART BY:\nShark in a Hat',
                'PROGRAMMED BY:\nShark in a Hat',
                'POWERED BY:\nThe Plotato Engine',
                'POWERED BY:\nBrython'
                ];    
</pre>
                	<h3>version.txt</h3>
                	<p>
                		This little file only contains one value - the current version of the data files. It's used 
                		to display the game version, but apart from that it's up to the author to decide how it's used, changed or tracked.
                	</p>
<pre class="api">
 var data_version = '0.8.dev';   
</pre>                    
                	<h3>voices.txt</h3>
                	<p>
                		This file lists aliases for actors and what text-to-speech voice the actor should use.
                	</p>
<pre class="api">
var known_voices = [  "default",
                "emily",
                "ben",
                "fnpc",
                "mnpc"];

var speaker_alias = {   "boy": "mnpc",
                        "disclaimer": "default",
                        "femalevoice": "emily"
                    };    
</pre>                    
                    <a href='#top'>[Back to top]</a>
                </article>

            <h1 id='tools'>Tools</h1>
                <article>
                    <p>
                        The engine comes with a set of useful tools, most of them are written in Python/Brython and run as local .html files right in the browser, but some are standalone Python scripts that you need to run via a Python interpreter.  
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='plot_edit'>Plot Editor</h2>
                <article>
                    <h3>dev/plot_edit.html</h3>
                    <p>
                        The Plot Editor is the most important tool of all, as the plot file can easily grow to multiple megabytes in size for larger games and it's simply impractical to edit a file of that size by hand.
                    </p>
                    <img src="manual_img/editor_main.webp">
                    <p>
                		The Editor has 3 main elements - the toolbox in the top left corner, the node 
                		editor on the right and the plot graph taking up the rest of the space.
                	</p>
                	<h3>The Toolbox</h3>
                	<p>
                     When first starting the editor, the toolbox will always be collapsed and 
                     looking something like this:
                      <img src="manual_img/toolbox_mini.png">
                	</p>
                	<p>
                		Clicking on the toolbox will expand it (and this is true for all the widgets in the editor that have 
                		that little triangle at one side)
                		 <img src="manual_img/toolbox.png">
                	</p>
                	<p>
                		'Start from...' tells the editor what node to draw at the top of the node graph, or in other words -where to start from.
                	</p>
                	<p>
                		The dropdown here will list all the nodes that don't have a direct parent (ancestor), these are nodes 
                		that the player will probably move to through a jump node (a node with eval_jump_to).
                	</p>
                	<p>
                		It is recommended not to create cycling reference in the first node of a subplot. The first node can lead to as many 
                		other nodes as you like, but no node should connect back to that starting node. 
                	</p>
                	<p>
                		If you would create a plot graph such that 'node_a' leads to 'node_b' and 'node_b' leads to 'node_a' 
                		neither of these nodes would be listed in the 'Start from...' dropdown and both could become inaccessible
                		in the editor.
                	</p>
                	<h3>Filter nodes...</h3>
                	 <img src="manual_img/toolbox_filter.png">
                	<p>
                		This tool allows to one to write a custom rule and filter out all the nodes that fit the rule.
                	</p>
                	<p>
                		For example if you need to find all the nodes that use the image 'img/npc/dude6.png' you could write:
                		<span class='api_inline'>npc == 'img/npc/dude6.png' </span> and click FILTER to get a list of nodes in the dropdown 
                		below (selecting an item from the dropdown will draw the graph from that node).
                	</p>
                	<p>
                		The function doing the filtering brings in the fields from each node into the local scope. You can use any of them directly 
                		<ul>
                		    <li>text</li>
                		    <li>next</li>
                		    <li>pc</li>
                		    <li>npc</li>
                		    <li>img</li>
                		    <li>eval_jump_to</li>
                		    <li>branch (as a list)</li>
                		    <li>choice (as a list)</li>
                		    <li>cmd (as a list)</li>
                		</ul>
                	</p>
                	<h3>Python</h3>
                	<img src="manual_img/toobox_python.png">
                	<p>
                	    Here you can execute your custom Python script right in the editor.
                	</p>
                	<p>
                	    The top text area is meant for your script and the bottom one is where the 
                	    <span class='api_inline'>log()</span> function prints it's output.
                	</p>
                	<p>
                	    This is a feature meant for advanced users and might be hard to use for anyone not intimately familiar
                	    with the inner workings of the editor.
                	</p>
                	<h3>Notes</h3>
                	<p>
                	    This is a text input area for your notes. You can write anything you want here, it will be saved in the plot.txt file.
                	</p>
                	<h3>Save Vars</h3>
                	<img src="manual_img/toolbox_save_var.png">
                	<p>
                	    This section list all nodes that write anything to the save DataStore and groups them by the variable name. 
                	    It is not always perfectly accurate.
                	</p>
                	<h3>Quests</h3>
                	 <img src="manual_img/toolbox_quests.png">
                	 <p>
                	     This section lists all the nodes that add or update the quest log.
                	 </p>
                	 <h3>Mods</h3>
                     <img src="manual_img/toolbox_mods.png">
                	 <h3>LOAD MOD</h3>
                	 <p>
                	     Clicking this button will allow you to load a previously saved mod. Because of the flexibility
                	     of mods not all of them can be guaranteed to load properly. 
                	 </p>
                	 <p>
                	     The editor executes the mod in a separated namespace and retrives 'data.plot' from that namespace 
                	     as modified by the mod. If a mod is implemented in a way that relies on 'data.plot' to have specific 
                	     keys and values, that mod may fail to load in the editor.
                	 </p>
                	 <p>
                	     The recommended way to create plot mods is to update 'data.plot' in place eg.:
<pre class='api'>
mod_plot = {} # the data to be inserted
for k,v in mod_plot.items(): 
    data.plot[k] = v 
</pre>
                	 </p>
                	<h3>WRITE MOD</h3>
                	 <p>
                	     Clicking this button will save the changes you've made to the plot as a mod file, that can be loaded via the mod manager.
                	 </p>
                	 <h3>Config</h3>
                	 <img src="manual_img/toolbox_config.png">
                	 <p>
                	     In this section you can change the position and font size of the Node editor. Usefull on mobile 
                	     and touchscreens where one can't just drag or resize the Node Editor panel.
                	 </p>
                	 <h3>WRITE</h3>
                	 <p>
                	     Clicking this button will generate a plot.txt file and ask the user to save it (depending on 
                         browser and configuration, it may ask for a name and destination or just write the file to a default location)
                	 </p>
                
                	 <hr>
                	 <h3>Node Editor</h3>
                	 <img src="manual_img/normal_node.png">
                	 <p>
                		The node editor is located on the right side of the window, but it's position can be 
                		changed by simply clicking on the header (part of the editor that says --EDIT NODE--) and 
                		dragging the whole thing to wherever you want.
                	</p>
                	 <p>
                		Just like the toobox the node editor can be minimized/collapsed.
                	</p>
                	<p>
                		Most input fields in the node editor provide hints. These can be names of existing nodes, 
                		image filenames, npc images or sometimes Python functions or snippets 
                		<img src="manual_img/hints.png">
                	</p>
                	<p>
                		The editor also supports drag and drop for input fields that require a node name (next, targets). You can 
                		drag a node from the node graph into a input field to automatically fill it out with the name of the node.
                	</p>
                	<h3>Node Type</h3>
                	<p>
                		The editor has 4 types of nodes:
                		<ul>
                		    <li>Normal</li>
                		    <li>Choice</li>
                		    <li>Branch</li>
                		    <li>Jump</li>
                		</ul>
                	</p>
                	<p>
                		A normal node is any node that has a 'next' field, a choice node is one that has a choice field, and so one.
                	</p>
                	<p>
                	    The engine does not make this kind of distinction, but since a choice node shouldn't have a next field and a 
                	    branch node is not supposed to have text, it is only logical to have some sort of mechanism in the editor
                	    to minimize potential user errors.
                	</p>
                	<p>
                	    Switching between the node types is done by clicking on one of the radio buttons with the nodae type names. 
                	    This will hide or show fields appropriate for the given node type.
                	</p>
                	<p>
                		It is important to note that this is just a editor feature, and the underlying plot node can have 
                		all the fields filled no matter what type of node the editor thinks the node is.
                	</p>
                	<p>
                		The editor will not try to guess the type of a node when editing an existing node, so the fields visible 
                		when first vieeing a nodes properties may be wrong and you may need to manually switch the node type 
                		to see the content of the nodes fields.
                	</p>
                	<hr>
                	<h3>Common elements</h3>
                	<p>
                		Depending on the type of node, the editor may display a different set of widget, but no matter 
                		what type of node you are creating or edditing, all of them share some common elements.
                	</p>
                	<h3>Draw Graph from This Node button</h3>
                	<p>
                		As the name suggest, pressing this button will draw the plot graph from the current node.
                	</p>
                	<h3>name</h3>
                	<p>
                		name is the unique identifier of a node, it's id, the key under which it is stored in the plot graph.
                	</p>
                	<p>
                		If you edit a node and change its name, the changes will be saved under this new name, leaving the 
                		original node unchanged.
                	</p>
                	<p>
                		It is up to the author to keep the names unique, as the editor will override any existing nodes 
                		without asking if there are any node name conflicts.
                	</p>
                	<h3>cmd</h3>
                	<img src="manual_img/cmd.png">
                	<p>
                		Commands are common to all nodes and one node can have a virtually unlimited number of commands.
                		Clicking the '+ New CMD' button will add another input field where you can type in your 
                		Python expressions.
                	</p>
                	<h3>Save Node button</h3>
                	<p>
                		Clicking this button will save all the changes you have made to the node and re-draw the plot graph.
                		The editor will also create new, empty nodes if you've specified next nodes or target nodes that don't exist. 
                	</p>
                	<p>
                		The changes are saved in the browsers memory, you still need to save the changes to a file (write).
                	</p>
                	<h3>Remove Sub-Plot button</h3>
                	<p>
                		Clicking this button will remove the current node and will also try to remove any and all of it's 
                	    descendants.
                	</p>
                	<h3>Remove THIS node button</h3>
                	<p>
                	    This will remove the current node as well as removing all reference to it from it's direct ancestors.
                	</p>
                	<h3>In-Game Autosave tickox</h3>
                	<p>
                	    In the rare occasion you want to disable autosave for a specific node, you can un-tick this tickbox.
                	</p>
                	<h3>Clone subplot</h3>
                    <img src="manual_img/clone.png">
                    <p>
                        This is an experimental feature that lets one clone multiple nodes at once and insert them 
                        right back into the plot graph under different names.
                    </p>
                	<hr>
                	<h3> NODE TYPES:</h3>
                	<h3>Normal node</h3>
                	 <img src="manual_img/normal_node.png">
                	 <p>
                		A normal node has the following fields:
                		<ul>
                		    <li>name (required) - unique id of the node</li>
                		    <li>next - (usually required) name of the next node in the node graph</li>
                		    <li>PC - state/look of the player avatar/paperdoll (hidden if blank)</li>
                		    <li>txt - (usually required) Text visible to the player</li>
                		    <li>npc - NPC avatar/paperdoll</li>
                		    <li>img - background image</li>
                		    <li>cmd - commands run when the node is shown</li>
                		</ul>
                	</p>
                	<p>
                	    All fields except the name are optional. The name needs to be unique, if you save a node using a name 
                	    that some other node already has - the editor will override the existing node without asking.
                	</p>
                	<p>
                		The 'name +1' button will automatically generate a new name for the next node based on the current node name.
                		If the current node name ends with a underscore and a number (like <span class='api_inline'>some_node_69</span>), 
                		the name for the next button will be generated by adding +1 to that trailing number 
                		( <span class='api_inline'>some_node_70</span>). For node names without numbers the generated next node name will have '_1' 
                		at the end (<span class='api_inline'>some_node</span> ==> <span class='api_inline'>some_node_1</span>.
                	</p>
                	<p>
                	    The next field can be skipped only if calling <span class='api_inline'>show_map()</span> in the cmd 
                	    or some other similar function that provides an alternative way of moving to other nodes.
                	</p>
                	<p>
                	    The txt field should be blank only if calling  <span class='api_inline'>shop()</span> or  
                	    <span class='api_inline'>change_clothes()</span> or some other function providing an alternative 
                	    way of progressing to the next node. It should also be left blank when using 
                	    <span class='api_inline'>show_map()</span>.
                	</p>
                	<p>
                	    Note: In normal gameplay the player needs to click somewhere on the text panel to progress to the next node, 
                	    so if thereis no text, there is nothing that the player can click.
                	</p>
                	<p>
                		The npc and img fields have a built-in preview option, one just needs to expand that field.
                	</p>
                	<h3>Choice node</h3>
                	<img src="manual_img/choice.png">
                	<p>
                	    A choice node is very similar to a normal node, with the only
                	     change being that the next field is replaced with the choice fields.
                	</p>
                	<p>
                		The choice fields is an array of 8 rows of 3 input fields each. These represent the 
                		conditions, labels and targets for each of the choices shown to the player.
                	</p>
                	<p>
                		Choice is described in detail in it's own section, refere to that for further information.
                	</p>
                	<h3>Branch</h3>
                    <img src="manual_img/branch.png">
                    <p>
                		Branch at first glance is very similar to Choice, but it is quite different. It has no txt, no npc. 
                		The branch fields only have a condition and target and no label. Unlike choice there is no maximum 
                		number of branches in a node and one can add as many as needed by pressing the '+New Branch' button.
                	</p>
                	<p>
                		Branch is described in detail in it's own section, refere to that for further information.
                	</p>
                    <h3>Jump</h3>
                    <img src="manual_img/jump.png">
                    <p>
                		The set of fields for a jump node is almost identical to that of a branch node, with only the branch fields 
                		replaced with one eval_jump_to field.
                	</p>
                	<p>
                		Jump is described in detail in it's own section... You know the drill by now...
                	</p>
                    <hr>
                   <h3>Plot graph</h3>
                    <img src="manual_img/plot_graph.png">
                    <p>
                        The plot graph takes up the majority of the editor window. Each plot node is represented by a small, 
                        colored rectangle. Arrows show how the nodes are connected. Each node has a small, round button (nub) next to its name, clickin it will 
                        select the node and load it into the node editor.
                    </p>
                    <p>
                        When a node is selected the editor highlights it's direct ancestor all it's descendants and fades out 
                        all the nodes that can no longer be reached from the selected node.
                    </p>
                    <p>
                        Depending on the content of a node, additional icons can be displayed under the nodes name. 
                        These help to find nodes with branches, commands, images, pc or npc. Hovering the mouse cursor
                        over one of those icons usually give extra informations without the need to select the node and 
                        look through its fields.
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='item_edit'>Item Editor</h2>
                <article>
                    <h3>dev/item_editor.html</h3>
                    <p>
                        This is a tool designed to edit and preview existing clothes. It can also be used to assign items to shop, but a more specialized tool for that also exists. 
                    </p>
                    <p>
                        One might need to edit this tool to add/remove custom item tags suitable for each game.
                    </p>

                    <img src="manual_img/item_editor.png">

                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='item_maker'>Item Maker</h2>
                <article>
                    <h3>dev/item_maker.html</h3>
                    <p>
                        This is a tool designed to create new clothing items from image files. It doesn't save the output to a file, but offers it in a text field so that it can be copy/pasted into data/items.txt
                    </p>
                    <img src="manual_img/item_maker.png">
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='shop_edit'>Shop Editor</h2>
                <article>
                    <h3>dev/shop_editor.html</h3>
                    <p>
                        This is a tool designed to edit the content of shops.
                    </p>
                    <img src="manual_img/shop_editor.png">
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='mod_manager'>Mod Manager</h2>
                <article>
                    <h3>dev/mod_manager.html</h3>
                    <p>
                        This is a tool meant to be used by end users/players. It allows to load mods from .py files and determine in what order they are loaded by the game. 
                    </p>
                    <img src="manual_img/mod_manager.png">
                    <a href='#top'>[Back to top]</a>
                </article>
            <h2 id='scripts'>Python scripts </h2>
                <article>
                    <h3>dev/make_datalist.py</h3>
                    <p>
                        This script generates datalists (hints) for plot_editor.html. Copy/paste the output.
                    </p>
                    <h3>dev/make_doc.py</h3>
                    <p>
                        This script generates rough API documentation in html format based on function docstrings.
                    </p>
                    <h3>dev/svg_gen.py</h3>
                    <p>
                        This script generates colored dots and arrows as used by the plot_editor.html. It is dummy stupid.
                    </p>
                    <h3>dev/webpy.py</h3>
                    <p>
                        Script to convert a dir of images(png/jpg) to .webp files, libwebp needs to be installed and present (on path).
                    </p>
                    <p>
                        Usage:<br>
                        <span class="api_inline">python webpy.py source_dir [target_dir] [cwebp_args]</span>
                    </p>
                    <a href='#top'>[Back to top]</a>
                </article>

            <h1 id='api'>API</h1>
                <article>
                    <p>
                        Most of the engines code is organized into functions, classes are avoided, unless they can provide some useful features. 
                    </p>
                    <p>
                        This is a deliberate design choice, that minimizes the amount of redundant typing  -it's simpler, smaller, faster, better (?) to write <span class="api_inline">music('oh_my')</span> then for example <span class="api_inline">game.audio.music('oh_my')</span>. Those few extra letters might not seem much, but repeated thousands of times in the plot.txt file could add megabytes of bloat.
                    </p>
                    <p>
                        Some parts of the engine could be simplified or improved if some standard Python library modules where used, unfortunately importing these modules from Brython require the browser to download and process multiple megabytes of javascript - something that probably best be avoided. 
                    </p>
                    <p>
                        All functions that start with an underscore (like <span class="api_inline">_on_choice_click()</span>) are 'private' functions, implementation details that most game authors needn't to worry about. One shouldn't use them from inside a cmd fields in a plot node.
                    </p>
                    <h3>Public API:</h3>
                    <div class='api'>
                            <br>CONSTANTS:<br>
                            <span class='api_def'>TIME.NIGHT</span> = <span class='api_num'>0 </span>      # 0-3 <br>
                            <span class='api_def'>TIME.MORNING</span> = <span class='api_num'>1</span>     # 4-7 <br>
                            <span class='api_def'>TIME.NOON</span> = <span class='api_num'>2 </span>       # 8-11 <br>
                            <span class='api_def'>TIME.MIDDAY</span> = <span class='api_num'>3</span>      # 12-15 <br>
                            <span class='api_def'>TIME.AFTERNOON</span> = <span class='api_num'>4</span>   # 16-19 <br>
                            <span class='api_def'>TIME.EVENING</span> = <span class='api_num'>5</span>     # 20-23 <br>
                            <br>
                            <span class='api_def'>TIME.MONDAY</span> = <span class='api_num'>0</span> <br>
                            <span class='api_def'>TIME.TUESDAY</span> = <span class='api_num'>1</span> <br>
                            <span class='api_def'>TIME.WEDNESDAY</span> = <span class='api_num'>2</span> <br>
                            <span class='api_def'>TIME.THURSDAY</span> = <span class='api_num'>3</span> <br>
                            <span class='api_def'>TIME.FRIDAY</span> = <span class='api_num'>4</span> <br>
                            <span class='api_def'>TIME.SATURDAY</span> = <span class='api_num'>5</span> <br>
                            <span class='api_def'>TIME.SUNDAY</span> = <span class='api_num'>6</span> <br>
                           <br>                            
                            ERROR FEEDBACK:<br>
                            <span class='api_def'>show_error</span>( txt, do_clear=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                            Show a error message, if clear is True old error msg are removed
                            </div>      

                            UTILITY FUNCTIONS:<br>                         
                            <span class='api_def'>add_mod_cfg</span>( name, buttons ):
                            <div class='api_doc'>
                             Adds a div with the mod name and buttons to the mods config screen
                            buttons' should be a dict with the text as the key and the command as the value
                            </div>
                            <span class='api_def'>clamp</span>( x, min_val, max_val ):
                            <div class='api_doc'>
                             returns the value of x constrained to the range min_val to max_val.
                            </div>  
                            <span class='api_def'>open_url</span>( url, new_tab=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                             Opens/redirects to an URL.
                            If new_tab is True it will be opened in a new tab/window(?)
                            </div>



                            RANDOM:<br>                       
                            <span class='api_def'>random</span>(  ):
                            <div class='api_doc'>
                            Returns a random float in 0.0-1.0 range,
                            uses javascript  Math.random
                            </div>
                            <span class='api_def'>randint</span>( start, stop=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Returns a random int in start-stop range,
                            Note: 'start' and 'stop' are included in the results eg.:
                            randint(1,6) may return 1, 2, 3, 4, 5 or 6!
                            uses javascript Math.random
                            </div>
                            <span class='api_def'>random_choice</span>( input_list, weights=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Returns a random element from the input_list
                            weights is a optional list of integer weights
                            </div>
                            <span class='api_def'>random_choice_adv</span>( name, weights, static_weights_bonus=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Returns a weighted random element from the weights dict
                            eg.{'a':10,'b':5,'c':1} returns 'a' in 62.5%, 'b' in 32.25%, 'c' in 6.25%
                            After each call the chosen weights are reduced by 1 (to a minimum of 1).
                            name' is the prefix used for storing previous results.
                            When all weights become equal the wights reset to the initial value.
                            The same item can't be chosen twice in a row.
                            if static_weights_bonus is provided, its values are added to the weights dict
                            </div>
                            <span class='api_def'>chance</span>( p ):
                            <div class='api_doc'>
                             Returns True in 'p'% cases,
                            p' should be in the 0-100 range
                            </div>
                            <span class='api_def'>d</span>( sides, num=<span class='api_num'>1</span> ):
                            <div class='api_doc'>
                            Rolls a die with 'sides' number of sides, eg. d(6),
                            to roll multiple dice pass in a num eg. D&D '4d6' would be d(6, 4)
                            </div>
                            

                            PERSISTENT STORAGE:<br>    
                            <div class='api_doc'> class <span class='api_def'> DataStore(object):</span><br>
                                <span class='api_def'>exists</span>( cls, name ):
                                <div class='api_doc'>
                                Returns true if a DataStore with the given name exists
                                </div>  
                                <span class='api_def'>add_item</span>( self, name, value=<span class='api_num'>''</span> ):
                                <div class='api_doc'>
                                Set name to value, same as self[name]=value
                                </div>
                                <span class='api_def'>set_list</span>( self, key, input_list ):
                                <div class='api_doc'>
                                 Stores the input_list as a string
                                </div>
                                <span class='api_def'>get_list</span>( self, name ):
                                <div class='api_doc'>
                                 Returns a value as if it was a list
                                </div>
                                <span class='api_def'>append_list</span>( self, name, value ):
                                <div class='api_doc'>
                                Appends an item to a list stored using set_list()
                                Creates a new list if needed
                                </div>
                                <span class='api_def'>del_from_list</span>( self, list_name, value ):
                                <div class='api_doc'>
                                 Remove an item from a list stored using set_list()
                                </div>
                                <span class='api_def'>is_empty</span>( self ):
                                <div class='api_doc'>
                                Returns True if there are no keys in the db
                                </div>
                                <span class='api_def'>items</span>( self ):
                                <div class='api_doc'>
                                Returns an iterator over the key and values
                                </div>
                                <span class='api_def'>clear</span>( self, subprefix=<span class='api_num'>None</span> ):
                                <div class='api_doc'>
                                Removes keys and values
                                if subprefix is not empty only removes keys that starts with subprefix
                                </div>
                                <span class='api_def'>add_flag</span>( self, key, value ):
                                <div class='api_doc'>
                                 Adds a flag to a key name.
                                Use has_flag() to check if the flag has been set.
                                </div>
                                <span class='api_def'>has_flag</span>( self, key, value ):
                                <div class='api_doc'>
                                 Checks if value flag has been set under the key name
                                </div>
                                <span class='api_def'>get_flags</span>( self, key ):
                                <div class='api_doc'>
                                 Returns a list of flags set under the key name.
                                </div>
                                <span class='api_def'>remove_flag</span>( self, key, flag ):
                                <div class='api_doc'>
                                 Removes flag (or multiple flags if flag is a set)
                                </div>
                                <span class='api_def'>remove</span>( self, *keys ):
                                <div class='api_doc'>
                                 Removes a key(s) from the DB
                                </div>
                                <span class='api_def'>to_string</span>( self ):
                                <div class='api_doc'>
                                Returns a string with all the values of the DataStore,
                                this is the internal representation of the data
                                </div>
                                <span class='api_def'>from_string</span>( self, input_string, clear_old=<span class='api_num'>True</span> ):
                                <div class='api_doc'>
                                 Recreates the DataStore values from the input_string,
                                the input_string should be one generated by DataStore.to_string()
                                </div>                            
                            </div>   
                            <br><br>

                            IN-GAME TIME:<br>
                            <span class='api_def'>set_tce</span>( target, day, hour, map_poi, map_redirect ):
                            <div class='api_doc'>
                             Set a Time Critical Event (tce) that will start on the given 'day' and 'hour'.
                            target' is the name of the plot node that the player will jump to.
                            the event will trigger when moving via the map,
                            the map_poi must be one of the known Points Of Interest,
                            when the player clicks it at the right time ('day', 'hour') it will jump
                            to the 'target' plot node. Clicking any other poi will jump to 'map_redirect
                            If a TCE is set, the in-game clock will never (normally) progress past day*24+hour,
                            until the event is resolved.
                            Only 1 (one) TCE can be set for a given day, hour.
                            </div>
                            <span class='api_def'>remove_tce</span>( day=<span class='api_num'>None</span>, hour=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Removes (cancels) a TCE.
                            Called automatically when a TCE is triggered from map.
                            If day is None and hour is None the current time (save.time) is used
                            </div>                     
                            <span class='api_def'>get_tce_arg</span>( tce, arg_name ):
                            <div class='api_doc'>
                             Returns the arguments used for creating the given TCE.
                            tce must be a list as returned by get_tce()
                            valid arg_name values: 'target', 'day', 'hour', 'map_poi', 'map_redirect
                            </div>
                            <span class='api_def'>get_tce</span>( timestamp =<span class='api_num'> None</span> ):
                            <div class='api_doc'>
                             Returns the [target, day, hour, map_poi, map_redirect]
                            set for a TCE with the given timestamp (day*24+hour)
                            if timestamp is None - the current time (save.time) is used
                            if there is no TCE with the timestamp - returns None
                            </div>
                            <span class='api_def'>get_hour</span>(  ):
                            <div class='api_doc'>
                            Returns the current hour
                            </div>
                            <span class='api_def'>get_weekday</span>(  ):
                            <div class='api_doc'>
                            Returns the day of the week as an int
                            </div>
                            <span class='api_def'>is_weekday</span>( weekday ):
                            <div class='api_doc'>
                            Returns True if today is 'weekday
                            eg.: 'is_weekday(TIME.MONDAY)
                            To test if it's a 'work day' use 'not is_weekend()
                            </div>
                            <span class='api_def'>is_weekend</span>(  ):
                            <div class='api_doc'>
                             Returns True if it's SATURDAY, SUNDAY or FRIDAY AFTERNOON
                            </div>
                            <span class='api_def'>get_datetime</span>(  ):
                            <div class='api_doc'>
                             Returns (day, hour)
                            </div>
                            <span class='api_def'>get_day</span>(  ):
                            <div class='api_doc'>
                             Returns the current day number (starting from 0)
                            </div>
                            <span class='api_def'>is_time_of_day</span>( *time_of_day_list ):
                            <div class='api_doc'>
                            Returns True if the current time of day is in the time_of_day_list
                            eg: 'is_time_of_day(TIME.MORNING, TIME.NOON)
                            </div>
                            <span class='api_def'>is_day</span>(  ):
                            <div class='api_doc'>
                             Returns True if it's MORNING, NOON, MIDDAY, or AFTERNOON
                            </div>
                            <span class='api_def'>get_time_of_day</span>(  ):
                            <div class='api_doc'>
                             Returns the time of day as an int
                            </div>
                            <span class='api_def'>set_hard_datetime</span>( day, hour ):
                            <div class='api_doc'>
                            Set the in game time, ignoring everything
                            </div>
                            <span class='api_def'>get_day_name</span>( future_day=<span class='api_num'>0</span>, exact_day=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns the (string) name of the current day
                            if future_day is provided it returns the name
                            of the day future_day days away
                            </div>
                            <span class='api_def'>get_time_of_day_name</span>( use_in_at=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns the time of day as a string
                            </div>
                            <span class='api_def'>set_time_of_day</span>( time_of_day ):
                            <div class='api_doc'>
                             Sets the time of day, (usually) moving the time forward.
                            Note: The actual time is set to the first hour in the give time period,
                            this may turn the clock back by up to 3h!
                            eg. if it's 7AM in the morning and you call
                            set_time_of_day(TIME.MORNING) it will become 4AM

                            </div>
                            <span class='api_def'>progress_time</span>( amount=<span class='api_num'>1</span> ):
                            <div class='api_doc'>
                             Moves the in-game clock by amount hours (int),
                            also displays the current time/date in the status div
                            </div>

                            ITEMS/INVENTORY MANAGEMENT:<br>
                            <span class='api_def'>get_equipped</span>( tag=<span class='api_num'>None</span>, slot=<span class='api_num'>None</span>, exclude_tag=<span class='api_num'>'nude'</span> ):
                            <div class='api_doc'>
                             Returns a list of equipped items
                            if tag is not None only the items with the tag get returned
                            if slot is not None only the (one) item in the slot is returned (if any)
                            no item that has the 'exclude_tag' tag will be returned
                            </div>
                            <span class='api_def'>get_item_name</span>( item_id, *args ):
                            <div class='api_doc'>
                             Returns the name or names of the given item or items
                            Note: Parts of the names in parenthesis will be dropped e.g 'Shirt (pink)' -> 'Shirt
                            For multiple items the names will be comma separated.
                            </div>
                            <span class='api_def'>give_clothes_by_tag</span>( tag ):
                            <div class='api_doc'>
                            Give all clothes that have the given tag
                            </div>
                            <span class='api_def'>count_clothes_by_tag</span>( tag, eqquiped_only=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns the number of items the player has with the given tag
                            if eqquiped_only is True, it checks only equipped items.
                            </div>
                            <span class='api_def'>has_clothes_by_tag</span>( tag, eqquiped_only=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns True if the player has any items with the given tag
                            if eqquiped_only is True, it checks only equipped items.
                            </div>
                            <span class='api_def'>strip_nude</span>(  ):
                            <div class='api_doc'>
                            Takes of all the clothes
                            </div>
                            <span class='api_def'>set_clothes</span>( clothes, *args, **kwargs ):
                            <div class='api_doc'>
                            Gives and equips all the clothes. Additional clothes can be passed
                            as positional arguments or clothes can be a list
                            If multiple items in the list share the same slots the last one will be used.
                            No items are striped before updating the equipment.
                            Also shows the PC avatar/paperdoll if show_pc (key-word-argument) is True
                            </div>
                            <span class='api_def'>change_clothes</span>( tag_set=<span class='api_num'>None</span>, enforce_stats=<span class='api_num'>1</span>, limited=<span class='api_num'>False</span>, loopback=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Alias for shop with no items
                            </div>
                            <span class='api_def'>shop</span>( shop_id=<span class='api_num'>None</span>, tag_set=<span class='api_num'>None</span>, enforce_stats=<span class='api_num'>1</span>, buyback=<span class='api_num'>False</span>, discount=<span class='api_num'>None</span>, limited=<span class='api_num'>False</span>, loopback=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Show the shop/wardrobe screen. <br>
                            shop_id is the name of the shop (see data/shops.txt) or None (for wardrobe)
                            tag_set - if it's not None, only items that have at least one tag from the tag_set are shown <br>
                             enforce_stats - if False, the player will be able to wear any combination of clothes regardless of stats. <br>
                             buyback - if True, the PC can sell all her clothes to the shop, else only the items in the current shopping session (in the shopping cart) can be returned.<br>
                             discount - all shop prices are multiplied by 'discount' (rounded down)<br>
                             limited - if True, the available items will be limited to items from the current clothes list  (saved using update_current_clothes_list() or auto-saved when the player closes the shop ui)<br>
                             loopback - if True, the game will return to the plot node shown before the shop opened (used for cheats/debug)<br>
                            </div>
                            <span class='api_def'>update_current_clothes_list</span>(  ):
                            <div class='api_doc'>
                             Update the current clothes list
                            </div>
                            <span class='api_def'>restore_clothes</span>(  ):
                            <div class='api_doc'>
                            Restore previously saved clothes
                            </div>
                            <span class='api_def'>is_exposed</span>( test_expo, logic=<span class='api_num'>'any'</span>, current_expo=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns True/False depending on current clothes and the given test_expo.
                            Use the values from the EXPO eg.:
                            test_expo=EXPO.PUSSY+EXPO.PART_BOOBS
                            if logic == 'any': returns True if at least one bit matches
                            if logic == 'all': returns True if all bit match
                            if logic == 'some': uses RNG, returns True more often if more bits match
                            </div>
                            <span class='api_def'>get_exposure</span>( tags=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns a int (bitmask) used for checking nudity
                            </div>
                            <span class='api_def'>match_clothes</span>( test_set ):
                            <div class='api_doc'>
                             Returns the % match between the current clothes and the test_set
                            as a float in 0.0, 1.0 range.
                            Note: test_set must be a set!
                            </div>
                            <span class='api_def'>check_uniform</span>( slots, tags, current_items=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Check if the clothes_set is a valid uniform.
                            A uniform is valid if all items in 'slots' have
                            at least one of the tags in the 'tags' set
                            </div>
                            <span class='api_def'>get_underwear</span>(  ):
                            <div class='api_doc'>
                            Returns a list of currently equiped underwear types, one of:
                            ['bra', 'panties']
                            ['bra']
                            ['panties']
                            []
                            </div>
                            <span class='api_def'>get_equipped_tagset</span>(  ):
                            <div class='api_doc'>
                             Returns a set with the tags of the currently equipped clothes
                            </div>
                            <span class='api_def'>get_clothes_stats</span>( clothes_list ):
                            <div class='api_doc'>
                             Returns a tuple that is the slutiness value of the clothes in the clothes_list
                            and the name of the uniform type
                            eg. (7, 'School Uniform')
                            </div>

                            CREDITS:<br>
                            <span class='api_def'>start_credits</span>(  ):
                            <div class='api_doc'>
                            Fetches the credits txt and starts the credits animation
                            by default credits are in data/supporters.txt (var credits = ...)
                            </div>
                            <span class='api_def'>end_credits</span>(  ):
                            <div class='api_doc'>
                            End the credits animation
                            Note: The anim is now run by css, so this just hides an element
                            </div>

                            IN-LINE TEXT STYLING HELPERS:<br>
                            <span class='api_def'>S</span>( txt, css ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling
                            </div>
                            <span class='api_def'>RED</span>( txt ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling -color red
                            </div>
                            <span class='api_def'>B</span>( txt ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling - bold
                            </div>
                            <span class='api_def'>I</span>( txt ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling - italic
                            </div>
                            <span class='api_def'>Rus</span>( txt ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling - russian font
                            </div>


                            CORE FUNCTIONS:<br>
                            <span class='api_def'>set_quest</span>( quest_name, quest_text=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Update the questlog setting the visible text to quest_text
                            </div>
                            <span class='api_def'>set_bodypart_img</span>( bodypart, img_path ):
                            <div class='api_doc'>
                             Change the image for a bodypart
                            img_path should be the relative path/url to the img
                            </div>
                            <span class='api_def'>set_body_overlay</span>( img_name=<span class='api_num'>None</span>, img_path=<span class='api_num'>'img/pc/'</span> ):
                            <div class='api_doc'>
                             Adds a overlay image on top of the pc image stack
                            </div>
                            <span class='api_def'>counter_inc</span>( name ):
                            <div class='api_doc'>
                            Increment a persistent counter by 1.
                            The counter will only be increased once per in-game date/time
                            </div>
                            <span class='api_def'>counter_get</span>( name ):
                            <div class='api_doc'>
                             Get the value of a counter
                            </div>
                            <span class='api_def'>exec_once</span>( cmd ):
                            <div class='api_doc'>
                             Run a command once per game/visit-to-node
                            </div>
                            <span class='api_def'>splash</span>( rgba=<span class='api_num'>None</span>, mode=<span class='api_num'>'screen'</span>, backdrop_filter=<span class='api_num'>'none'</span>, anim=<span class='api_num'>'fade_out'</span>, time=<span class='api_num'>1100</span> ):
                            <div class='api_doc'>
                             Show a overlay with the color, blend mode and filter using the given animation
                            Note: Firefox has no support for backdrop-filter!
                            </div>
                            <span class='api_def'>svg_filter</span>( filter_name=<span class='api_num'>'default'</span> ):
                            <div class='api_doc'>
                            Set a filter on both pc and npc images
                            Note: Remember to reset the filter!!!
                            </div>
                            <span class='api_def'>overlay_img</span>( img_url=<span class='api_num'>None</span>, img_class=<span class='api_num'>'overlay_blend_screen'</span>, clear=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                             Adds an overlay image on top of the main image
                            </div>
                            <span class='api_def'>replace_parallax_img</span>( new_img_url, layer=<span class='api_num'>0</span> ):
                            <div class='api_doc'>
                             Replace one (1) image in the parallax image stack,
                            without resetting the animation
                            </div>
                            <span class='api_def'>parallax_imgs</span>( *args, **kwargs ):
                            <div class='api_doc'>
                            Add a set of images with scrolling effect,
                            img_list - image or is a list of images to display.
                            When multiple images are use they should be passed in back-to-front order,
                            that is the smallest, most far away image first and the biggest, closes image last.
                            scroll_dir - should be either 'y' (default) or 'x
                            if scroll_dir='y' the image(s) will be scrolled from top to bottom
                            if scroll_dir='x' the image(s) will be scrolled from side to side
                            Note: This is the CSS implementation, it's very slow on some hardware
                            </div>
                            <span class='api_def'>num_pc_bodymods</span>( mod_type=<span class='api_num'>'piercing'</span> ):
                            <div class='api_doc'>
                             Get the number of body modifications the PC currently has
                            mod_type can be 'piercing' or 'tattoo
                            </div>
                            <span class='api_def'>add_pc_bodymod</span>( name, img, mod_type=<span class='api_num'>'piercing'</span> ):
                            <div class='api_doc'>
                             Add a body modifications image
                            mod_type can be 'piercing' or 'tattoo
                            This function will silently fail if PC has 3 or more bodymods of that type
                            </div>
                            <span class='api_def'>show_pc</span>( visible=<span class='api_num'>True</span>, face=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Show the pc avatar image with the current clothing and face
                            </div>
                            <span class='api_def'>update_stats</span>(  ):
                            <div class='api_doc'>
                             Updates the player stats
                            currently adds +1 max_slut for every 4 points of slut
                            </div>

                            SAVE UTILITIES:<br>
                            <span class='api_def'>init_new_save</span>(  ):
                            <div class='api_doc'>
                             Resets all values in the save and inventory
                            to the initial values expected by the game.
                            </div>
                            <span class='api_def'>restore_last</span>(  ):
                            <div class='api_doc'>
                            Restore the background npc and pc images to the last saved state
                            </div>

                            GAME PLOT NAVIGATION:<br>
                            <span class='api_def'>move_to</span>( target, rollback=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Moves to the target plot node
                            if rollback is True, a rollback point is saved
                            </div>

                            MAP:<br>
                            <span class='api_def'>add_poi</span>( name ):
                            <div class='api_doc'>
                            Add a Point Of Interest to the list of known POIs
                            </div>
                            <span class='api_def'>del_poi</span>( name ):
                            <div class='api_doc'>
                             Removes a Point Of Interest to the list of known POIs
                            </div>
                            <span class='api_def'>show_map</span>( poi_list=<span class='api_num'>None</span>, show_known=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                             Shows the map screen updates the map pins POI
                            </div>
                            <span class='api_def'>remove_map_event</span>( target, from_poi=<span class='api_num'>None</span>, target_poi=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Removes a dynamic map event,
                            If target is None this will remove ALL map events for the  from_poi/target_poi
                            </div>
                            <span class='api_def'>set_map_event</span>( target, from_poi=<span class='api_num'>None</span>, target_poi=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Sets a dynamic map event
                            </div>

                            AUDIO/MUSIC/TTS:<br>
                            <span class='api_def'>tts_actor</span>( actor_name ):
                            <div class='api_doc'>
                             Set/override the tts speaker for one text box
                            Use in formatted text eg. { tts_actor('mnpc') }
                            </div>
                            <span class='api_def'>music</span>( name, loop=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                            Alias for play_music
                            </div>
                            <span class='api_def'>play_music</span>( url=<span class='api_num'>None</span>, loop=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                            Play a music(.mp3) file using the browsers build-in player
                            Same Origin Policy applies(?).
                            </div>
                        </div>



                    <h3>All functions:</h3>
                    <div class='api'>
                            <br>CONSTANTS:<br>
                            <span class='api_def'>TIME.NIGHT</span> = <span class='api_num'>0 </span>      # 0-3 <br>
                            <span class='api_def'>TIME.MORNING</span> = <span class='api_num'>1</span>     # 4-7 <br>
                            <span class='api_def'>TIME.NOON</span> = <span class='api_num'>2 </span>       # 8-11 <br>
                            <span class='api_def'>TIME.MIDDAY</span> = <span class='api_num'>3</span>      # 12-15 <br>
                            <span class='api_def'>TIME.AFTERNOON</span> = <span class='api_num'>4</span>   # 16-19 <br>
                            <span class='api_def'>TIME.EVENING</span> = <span class='api_num'>5</span>     # 20-23 <br>
                            <br>
                            <span class='api_def'>TIME.MONDAY</span> = <span class='api_num'>0</span> <br>
                            <span class='api_def'>TIME.TUESDAY</span> = <span class='api_num'>1</span> <br>
                            <span class='api_def'>TIME.WEDNESDAY</span> = <span class='api_num'>2</span> <br>
                            <span class='api_def'>TIME.THURSDAY</span> = <span class='api_num'>3</span> <br>
                            <span class='api_def'>TIME.FRIDAY</span> = <span class='api_num'>4</span> <br>
                            <span class='api_def'>TIME.SATURDAY</span> = <span class='api_num'>5</span> <br>
                            <span class='api_def'>TIME.SUNDAY</span> = <span class='api_num'>6</span> <br>
                           <br>                            
                            Error feedback:<br>
                            <span class='api_def'>show_error</span>( txt, do_clear=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                            Show a error message, if clear is True old error msg are removed
                            </div>
                            <span class='api_def'>_clear_error</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Remove a error from the error box
                            </div>



                            Utility functions:<br>
                            <span class='api_def'>_restart_anim</span>( element, anim_name=<span class='api_num'>None</span>, count=<span class='api_num'>None</span>, duration=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Change and/or restart the css animation-name of element.
                            Note: works by replacing the element with (a copy of?) the element
                            </div>
                            <span class='api_def'>_show</span>( element_id, show=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                            Shows (or hides) an dom element with id=element_id
                            Note: Hidden elements now use 'display: none;' not 'visibility: hidden;' !
                            </div>
                            <span class='api_def'>add_mod_cfg</span>( name, buttons ):
                            <div class='api_doc'>
                             Adds a div with the mod name and buttons to the mods config screen
                            buttons' should be a dict with the text as the key and the command as the value
                            </div>
                            <span class='api_def'>clamp</span>( x, min_val, max_val ):
                            <div class='api_doc'>
                             returns the value of x constrained to the range min_val to max_val.
                            </div>  
                            <span class='api_def'>open_url</span>( url, new_tab=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                             Opens/redirects to an URL.
                            If new_tab is True it will be opened in a new tab/window(?)
                            </div>



                            Random:<br>                       
                            <span class='api_def'>random</span>(  ):
                            <div class='api_doc'>
                            Returns a random float in 0.0-1.0 range,
                            uses javascript  Math.random
                            </div>
                            <span class='api_def'>randint</span>( start, stop=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Returns a random int in start-stop range,
                            Note: 'start' and 'stop' are included in the results eg.:
                            randint(1,6) may return 1, 2, 3, 4, 5 or 6!
                            uses javascript Math.random
                            </div>
                            <span class='api_def'>random_choice</span>( input_list, weights=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Returns a random element from the input_list
                            weights is a optional list of integer weights
                            </div>
                            <span class='api_def'>random_choice_adv</span>( name, weights, static_weights_bonus=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Returns a weighted random element from the weights dict
                            eg.{'a':10,'b':5,'c':1} returns 'a' in 62.5%, 'b' in 32.25%, 'c' in 6.25%
                            After each call the chosen weights are reduced by 1 (to a minimum of 1).
                            name' is the prefix used for storing previous results.
                            When all weights become equal the wights reset to the initial value.
                            The same item can't be chosen twice in a row.
                            if static_weights_bonus is provided, its values are added to the weights dict
                            </div>
                            <span class='api_def'>chance</span>( p ):
                            <div class='api_doc'>
                             Returns True in 'p'% cases,
                            p' should be in the 0-100 range
                            </div>
                            <span class='api_def'>d</span>( sides, num=<span class='api_num'>1</span> ):
                            <div class='api_doc'>
                            Rolls a die with 'sides' number of sides, eg. d(6),
                            to roll multiple dice pass in a num eg. D&D '4d6' would be d(6, 4)
                            </div>
                            

                            Persistent storage:<br>    
                            <div class='api_doc'> class <span class='api_def'> InMemoryStorage(dict):</span><br>
                                <span class='api_def'>__init__</span>( self ):
                                <div class='api_doc'>
                                Create a temp namespace in data.glob
                                </div>
                                <span class='api_def'>setItem</span>( self, key, item ):
                                <div class='api_doc'>
                                Set the item under the key
                                </div>
                                <span class='api_def'>getItem</span>( self, key ):
                                <div class='api_doc'>
                                Get the item under the key, returns None on error
                                </div>
                            </div>
                            <br><br>


                            <div class='api_doc'> class <span class='api_def'> DataStore(object):</span><br>
                                <span class='api_def'>exists</span>( cls, name ):
                                <div class='api_doc'>
                                Returns true if a DataStore with the given name exists
                                </div>
                                <span class='api_def'>__init__</span>( self, name ):
                                <div class='api_doc'>
                                Setup the instance
                                </div>
                                <span class='api_def'>inner_dict</span>( self ):
                                <div class='api_doc'>
                                 @property
                                </div>
                                <span class='api_def'>__getitem__</span>( self, key ):
                                <div class='api_doc'>
                                  x.__getitem__(y) <==> x[y]
                                </div>
                                <span class='api_def'>__setitem__</span>( self, key, item ):
                                <div class='api_doc'>
                                Set self[key] to value.
                                </div>
                                <span class='api_def'>add_item</span>( self, name, value=<span class='api_num'>''</span> ):
                                <div class='api_doc'>
                                Set name to value, same as self[name]=value
                                </div>
                                <span class='api_def'>set_list</span>( self, key, input_list ):
                                <div class='api_doc'>
                                 Stores the input_list as a string
                                </div>
                                <span class='api_def'>get_list</span>( self, name ):
                                <div class='api_doc'>
                                 Returns a value as if it was a list
                                </div>
                                <span class='api_def'>append_list</span>( self, name, value ):
                                <div class='api_doc'>
                                Appends an item to a list stored using set_list()
                                Creates a new list if needed
                                </div>
                                <span class='api_def'>del_from_list</span>( self, list_name, value ):
                                <div class='api_doc'>
                                 Remove an item from a list stored using set_list()
                                </div>
                                <span class='api_def'>is_empty</span>( self ):
                                <div class='api_doc'>
                                Returns True if there are no keys in the db
                                </div>
                                <span class='api_def'>items</span>( self ):
                                <div class='api_doc'>
                                Returns an iterator over the key and values
                                </div>
                                <span class='api_def'>clear</span>( self, subprefix=<span class='api_num'>None</span> ):
                                <div class='api_doc'>
                                Removes keys and values
                                if subprefix is not empty only removes keys that starts with subprefix
                                </div>
                                <span class='api_def'>add_flag</span>( self, key, value ):
                                <div class='api_doc'>
                                 Adds a flag to a key name.
                                Use has_flag() to check if the flag has been set.
                                </div>
                                <span class='api_def'>has_flag</span>( self, key, value ):
                                <div class='api_doc'>
                                 Checks if value flag has been set under the key name
                                </div>
                                <span class='api_def'>get_flags</span>( self, key ):
                                <div class='api_doc'>
                                 Returns a list of flags set under the key name.
                                </div>
                                <span class='api_def'>remove_flag</span>( self, key, flag ):
                                <div class='api_doc'>
                                 Removes flag (or multiple flags if flag is a set)
                                </div>
                                <span class='api_def'>remove</span>( self, *keys ):
                                <div class='api_doc'>
                                 Removes a key(s) from the DB
                                </div>
                                <span class='api_def'>to_string</span>( self ):
                                <div class='api_doc'>
                                Returns a string with all the values of the DataStore,
                                this is the internal representation of the data
                                </div>
                                <span class='api_def'>from_string</span>( self, input_string, clear_old=<span class='api_num'>True</span> ):
                                <div class='api_doc'>
                                 Recreates the DataStore values from the input_string,
                                the input_string should be one generated by DataStore.to_string()
                                </div>
                                <span class='api_def'>__contains__</span>( self, key ):
                                <div class='api_doc'>
                                True if the DataStore has the specified key, else False.
                                </div>
                                <span class='api_def'>__getattr__</span>( self, key ):
                                <div class='api_doc'>
                                dot access to values hack
                                </div>
                                <span class='api_def'>__setattr__</span>( self, key, item ):
                                <div class='api_doc'>
                                dot access to values hack
                                </div>
                                <span class='api_def'>__delitem__</span>( self, key ):
                                <div class='api_doc'>
                                 Delete self[key].
                                </div>                                
                            </div>   
                            <br><br>


                            Save/load and file writing/reading: <br>
                            <span class='api_def'>_load_from_file</span>( ev ):
                            <div class='api_doc'>
                            Loads a save from a given file,
                            needs to be bound to a file input 'input' element                                
                            </div>
                            <span class='api_def'>_save_to_file</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Writes a save to a file,
                            needs to be bound to a 'mousedown' event in a download link element                            
                            </div>


                            In-game time:<br>
                            <span class='api_def'>set_tce</span>( target, day, hour, map_poi, map_redirect ):
                            <div class='api_doc'>
                             Set a Time Critical Event (tce) that will start on the given 'day' and 'hour'.
                            target' is the name of the plot node that the player will jump to.
                            the event will trigger when moving via the map,
                            the map_poi must be one of the known Points Of Interest,
                            when the player clicks it at the right time ('day', 'hour') it will jump
                            to the 'target' plot node. Clicking any other poi will jump to 'map_redirect
                            If a TCE is set, the in-game clock will never (normally) progress past day*24+hour,
                            until the event is resolved.
                            Only 1 (one) TCE can be set for a given day, hour.
                            </div>
                            <span class='api_def'>remove_tce</span>( day=<span class='api_num'>None</span>, hour=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Removes (cancels) a TCE.
                            Called automatically when a TCE is triggered from map.
                            If day is None and hour is None the current time (save.time) is used
                            </div>
                            <span class='api_def'>_tce_clamp_time</span>( current_time, target_time ):
                            <div class='api_doc'>
                             Returns the maximum future time between current_time and target_time
                            that can be set before hitting a Time Critical Event
                            </div>
                            <span class='api_def'>get_tce_arg</span>( tce, arg_name ):
                            <div class='api_doc'>
                             Returns the arguments used for creating the given TCE.
                            tce must be a list as returned by get_tce()
                            valid arg_name values: 'target', 'day', 'hour', 'map_poi', 'map_redirect
                            </div>
                            <span class='api_def'>get_tce</span>( timestamp =<span class='api_num'> None</span> ):
                            <div class='api_doc'>
                             Returns the [target, day, hour, map_poi, map_redirect]
                            set for a TCE with the given timestamp (day*24+hour)
                            if timestamp is None - the current time (save.time) is used
                            if there is no TCE with the timestamp - returns None
                            </div>
                            <span class='api_def'>get_hour</span>(  ):
                            <div class='api_doc'>
                            Returns the current hour
                            </div>
                            <span class='api_def'>get_weekday</span>(  ):
                            <div class='api_doc'>
                            Returns the day of the week as an int
                            </div>
                            <span class='api_def'>is_weekday</span>( weekday ):
                            <div class='api_doc'>
                            Returns True if today is 'weekday
                            eg.: 'is_weekday(TIME.MONDAY)
                            To test if it's a 'work day' use 'not is_weekend()
                            </div>
                            <span class='api_def'>is_weekend</span>(  ):
                            <div class='api_doc'>
                             Returns True if it's SATURDAY, SUNDAY or FRIDAY AFTERNOON
                            </div>
                            <span class='api_def'>get_datetime</span>(  ):
                            <div class='api_doc'>
                             Returns (day, hour)
                            </div>
                            <span class='api_def'>get_day</span>(  ):
                            <div class='api_doc'>
                             Returns the current day number (starting from 0)
                            </div>
                            <span class='api_def'>is_time_of_day</span>( *time_of_day_list ):
                            <div class='api_doc'>
                            Returns True if the current time of day is in the time_of_day_list
                            eg: 'is_time_of_day(TIME.MORNING, TIME.NOON)
                            </div>
                            <span class='api_def'>is_day</span>(  ):
                            <div class='api_doc'>
                             Returns True if it's MORNING, NOON, MIDDAY, or AFTERNOON
                            </div>
                            <span class='api_def'>get_time_of_day</span>(  ):
                            <div class='api_doc'>
                             Returns the time of day as an int
                            </div>
                            <span class='api_def'>set_hard_datetime</span>( day, hour ):
                            <div class='api_doc'>
                            Set the in game time, ignoring everything
                            </div>
                            <span class='api_def'>get_day_name</span>( future_day=<span class='api_num'>0</span>, exact_day=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns the (string) name of the current day
                            if future_day is provided it returns the name
                            of the day future_day days away
                            </div>
                            <span class='api_def'>get_time_of_day_name</span>( use_in_at=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns the time of day as a string
                            </div>
                            <span class='api_def'>set_time_of_day</span>( time_of_day ):
                            <div class='api_doc'>
                             Sets the time of day, (usually) moving the time forward.
                            Note: The actual time is set to the first hour in the give time period,
                            this may turn the clock back by up to 3h!
                            eg. if it's 7AM in the morning and you call
                            set_time_of_day(TIME.MORNING) it will become 4AM

                            </div>
                            <span class='api_def'>progress_time</span>( amount=<span class='api_num'>1</span> ):
                            <div class='api_doc'>
                             Moves the in-game clock by amount hours (int),
                            also displays the current time/date in the status div
                            </div>

                            Items/inventory management:<br>
                            <span class='api_def'>get_equipped</span>( tag=<span class='api_num'>None</span>, slot=<span class='api_num'>None</span>, exclude_tag=<span class='api_num'>'nude'</span> ):
                            <div class='api_doc'>
                             Returns a list of equipped items
                            if tag is not None only the items with the tag get returned
                            if slot is not None only the (one) item in the slot is returned (if any)
                            no item that has the 'exclude_tag' tag will be returned
                            </div>
                            <span class='api_def'>get_item_name</span>( item_id, *args ):
                            <div class='api_doc'>
                             Returns the name or names of the given item or items
                            Note: Parts of the names in parenthesis will be dropped e.g 'Shirt (pink)' -> 'Shirt
                            For multiple items the names will be comma separated.
                            </div>
                            <span class='api_def'>give_clothes_by_tag</span>( tag ):
                            <div class='api_doc'>
                            Give all clothes that have the given tag
                            </div>
                            <span class='api_def'>count_clothes_by_tag</span>( tag, eqquiped_only=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns the number of items the player has with the given tag
                            if eqquiped_only is True, it checks only equipped items.
                            </div>
                            <span class='api_def'>has_clothes_by_tag</span>( tag, eqquiped_only=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Returns True if the player has any items with the given tag
                            if eqquiped_only is True, it checks only equipped items.
                            </div>
                            <span class='api_def'>_buy_item</span>( event ):
                            <div class='api_doc'>
                            Fired when PC buys new clothing,
                            the item id is embedded in the button/event id
                            </div>
                            <span class='api_def'>_sell_item</span>( event ):
                            <div class='api_doc'>
                            Fired when PC sells clothing,
                            the item id is embedded in the button/event id
                            </div>
                            <span class='api_def'>_update_clothing</span>( tag_set=<span class='api_num'>None</span>, limited=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Update the clothing selection and draw the current clothes on the avatar
                            </div>
                            <span class='api_def'>strip_nude</span>(  ):
                            <div class='api_doc'>
                            Takes of all the clothes
                            </div>
                            <span class='api_def'>set_clothes</span>( clothes, *args, **kwargs ):
                            <div class='api_doc'>
                            Gives and equips all the clothes. Additional clothes can be passed
                            as positional arguments or clothes can be a list
                            If multiple items in the list share the same slots the last one will be used.
                            No items are striped before updating the equipment.
                            Also shows the PC avatar/paperdoll if show_pc (key-word-argument) is True
                            </div>
                            <span class='api_def'>_on_shop_filter</span>( event ):
                            <div class='api_doc'>
                             Filter the items displayed in shop
                            </div>
                            <span class='api_def'>change_clothes</span>( tag_set=<span class='api_num'>None</span>, enforce_stats=<span class='api_num'>1</span>, limited=<span class='api_num'>False</span>, loopback=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Alias for shop with no items
                            </div>
                            <span class='api_def'>shop</span>( shop_id=<span class='api_num'>None</span>, tag_set=<span class='api_num'>None</span>, enforce_stats=<span class='api_num'>1</span>, buyback=<span class='api_num'>False</span>, discount=<span class='api_num'>None</span>, limited=<span class='api_num'>False</span>, loopback=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Show the shop/wardrobe screen. <br>
                            shop_id is the name of the shop (see data/shops.txt) or None (for wardrobe)
                            tag_set - if it's not None, only items that have at least one tag from the tag_set are shown <br>
                             enforce_stats - if False, the player will be able to wear any combination of clothes regardless of stats. <br>
                             buyback - if True, the PC can sell all her clothes to the shop, else only the items in the current shopping session (in the shopping cart) can be returned.<br>
                             discount - all shop prices are multiplied by 'discount' (rounded down)<br>
                             limited - if True, the available items will be limited to items from the current clothes list  (saved using update_current_clothes_list() or auto-saved when the player closes the shop ui)<br>
                             loopback - if True, the game will return to the plot node shown before the shop opened (used for cheats/debug)<br>
                            </div>
                            <span class='api_def'>update_current_clothes_list</span>(  ):
                            <div class='api_doc'>
                             Update the current clothes list
                            </div>
                            <span class='api_def'>restore_clothes</span>(  ):
                            <div class='api_doc'>
                            Restore previously saved clothes
                            </div>
                            <span class='api_def'>_close_shop</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Close the current shop, jump back to the plot-line
                            </div>
                            <span class='api_def'>is_exposed</span>( test_expo, logic=<span class='api_num'>'any'</span>, current_expo=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns True/False depending on current clothes and the given test_expo.
                            Use the values from the EXPO eg.:
                            test_expo=EXPO.PUSSY+EXPO.PART_BOOBS
                            if logic == 'any': returns True if at least one bit matches
                            if logic == 'all': returns True if all bit match
                            if logic == 'some': uses RNG, returns True more often if more bits match
                            </div>
                            <span class='api_def'>get_exposure</span>( tags=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Returns a int (bitmask) used for checking nudity
                            </div>
                            <span class='api_def'>match_clothes</span>( test_set ):
                            <div class='api_doc'>
                             Returns the % match between the current clothes and the test_set
                            as a float in 0.0, 1.0 range.
                            Note: test_set must be a set!
                            </div>
                            <span class='api_def'>check_uniform</span>( slots, tags, current_items=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Check if the clothes_set is a valid uniform.
                            A uniform is valid if all items in 'slots' have
                            at least one of the tags in the 'tags' set
                            </div>
                            <span class='api_def'>get_underwear</span>(  ):
                            <div class='api_doc'>
                            Returns a list of currently equiped underwear types, one of:
                            ['bra', 'panties']
                            ['bra']
                            ['panties']
                            []
                            </div>
                            <span class='api_def'>get_equipped_tagset</span>(  ):
                            <div class='api_doc'>
                             Returns a set with the tags of the currently equipped clothes
                            </div>
                            <span class='api_def'>_get_slut_delta_str</span>( item_name ):
                            <div class='api_doc'>
                             Returns string representing the sluttiness value of an outfit,
                            that is composed of what the PC is currently wearing + the 'item_name' item
                            </div>
                            <span class='api_def'>get_clothes_stats</span>( clothes_list ):
                            <div class='api_doc'>
                             Returns a tuple that is the slutiness value of the clothes in the clothes_list
                            and the name of the uniform type
                            eg. (7, 'School Uniform')
                            </div>
                            <span class='api_def'>_update_clothes_stats</span>( blink=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                            Update the stats and tags for the currently worn clothes
                            </div>
                            <span class='api_def'>_on_equip</span>( event ):
                            <div class='api_doc'>
                            Fired when the pc changes clothing
                            </div>
                            <span class='api_def'>_update_outfits</span>( tag_set=<span class='api_num'>None</span>, limited=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Update the list of known outfits
                            </div>
                            <span class='api_def'>_del_outfit</span>( event ):
                            <div class='api_doc'>
                             Remove the outfit encoded as event.target.id
                            </div>
                            <span class='api_def'>_use_outfit</span>( event ):
                            <div class='api_doc'>
                             Change the current clothes to the outfit encoded as event.target.id
                            </div>
                            <span class='api_def'>_add_outfit</span>( name, items=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Add an outfit to the list of known outfits
                            if items is None the currently used items will be saved
                            </div>

                            Credits:<br>
                            <span class='api_def'>start_credits</span>(  ):
                            <div class='api_doc'>
                            Fetches the credits txt and starts the credits animation
                            by default credits are in data/supporters.txt (var credits = ...)
                            </div>
                            <span class='api_def'>_next_credit</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Shows the next line of credits
                            if there are no more lines of credits - summons Cthulu
                            </div>
                            <span class='api_def'>end_credits</span>(  ):
                            <div class='api_doc'>
                            End the credits animation
                            Note: The anim is now run by css, so this just hides an element
                            </div>

                            In-line text styling helpers:<br>
                            <span class='api_def'>S</span>( txt, css ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling
                            </div>
                            <span class='api_def'>RED</span>( txt ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling -color red
                            </div>
                            <span class='api_def'>B</span>( txt ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling - bold
                            </div>
                            <span class='api_def'>I</span>( txt ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling - italic
                            </div>
                            <span class='api_def'>Rus</span>( txt ):
                            <div class='api_doc'>
                            Wrapper for creating in-line styling - russian font
                            </div>


                            Core functions:<br>
                            <span class='api_def'>_run_modal_cmd</span>( cmd ):
                            <div class='api_doc'>
                             Run the command bound to the ok button of a modal and hide the modal
                            </div>
                            <span class='api_def'>_show_modal</span>( header_txt, body_elements, ok_cmd, cancel_cmd=<span class='api_num'>None</span>, ok_txt=<span class='api_num'>'OK'</span>, cancel_txt=<span class='api_num'>'CANCEL'</span> ):
                            <div class='api_doc'>
                             Show a modal dialog box with ok/cancel buttons header_txt and body_elements
                            ok_cmd is executed when the player clicks on 'ok
                            </div>
                            <span class='api_def'>_show_modal_input</span>( text, default_value, ok_cmd ):
                            <div class='api_doc'>
                             Show a modal dialog box with ok/cancel buttons and a text input box
                            ok_cmd is executed when the player clicks on 'ok
                            </div>
                            <span class='api_def'>set_quest</span>( quest_name, quest_text=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Update the questlog setting the visible text to quest_text
                            </div>
                            <span class='api_def'>_update_questlog</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Updates the questlog and shows in on the screen
                            </div>
                            <span class='api_def'>_toggle_txt</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Show/hide the main text box if there is text in it,
                            also updates the menu button text appropriately
                            </div>
                            <span class='api_def'>set_bodypart_img</span>( bodypart, img_path ):
                            <div class='api_doc'>
                             Change the image for a bodypart
                            img_path should be the relative path/url to the img
                            </div>
                            <span class='api_def'>set_body_overlay</span>( img_name=<span class='api_num'>None</span>, img_path=<span class='api_num'>'img/pc/'</span> ):
                            <div class='api_doc'>
                             Adds a overlay image on top of the pc image stack
                            </div>
                            <span class='api_def'>counter_inc</span>( name ):
                            <div class='api_doc'>
                            Increment a persistent counter by 1.
                            The counter will only be increased once per in-game date/time
                            </div>
                            <span class='api_def'>counter_get</span>( name ):
                            <div class='api_doc'>
                             Get the value of a counter
                            </div>
                            <span class='api_def'>exec_once</span>( cmd ):
                            <div class='api_doc'>
                             Run a command once per game/visit-to-node
                            </div>
                            <span class='api_def'>_on_keydown</span>( event ):
                            <div class='api_doc'>
                             Fired when player presses a key on the keyboard
                            </div>
                            <span class='api_def'>splash</span>( rgba=<span class='api_num'>None</span>, mode=<span class='api_num'>'screen'</span>, backdrop_filter=<span class='api_num'>'none'</span>, anim=<span class='api_num'>'fade_out'</span>, time=<span class='api_num'>1100</span> ):
                            <div class='api_doc'>
                             Show a overlay with the color, blend mode and filter using the given animation
                            Note: Firefox has no support for backdrop-filter!
                            </div>
                            <span class='api_def'>svg_filter</span>( filter_name=<span class='api_num'>'default'</span> ):
                            <div class='api_doc'>
                            Set a filter on both pc and npc images
                            Note: Remember to reset the filter!!!
                            </div>
                            <span class='api_def'>overlay_img</span>( img_url=<span class='api_num'>None</span>, img_class=<span class='api_num'>'overlay_blend_screen'</span>, clear=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                             Adds an overlay image on top of the main image
                            </div>
                            <span class='api_def'>replace_parallax_img</span>( new_img_url, layer=<span class='api_num'>0</span> ):
                            <div class='api_doc'>
                             Replace one (1) image in the parallax image stack,
                            without resetting the animation
                            </div>
                            <span class='api_def'>parallax_imgs</span>( *args, **kwargs ):
                            <div class='api_doc'>
                            Add a set of images with scrolling effect,
                            img_list - image or is a list of images to display.
                            When multiple images are use they should be passed in back-to-front order,
                            that is the smallest, most far away image first and the biggest, closes image last.
                            scroll_dir - should be either 'y' (default) or 'x
                            if scroll_dir='y' the image(s) will be scrolled from top to bottom
                            if scroll_dir='x' the image(s) will be scrolled from side to side
                            Note: This is the CSS implementation, it's very slow on some hardware
                            </div>
                            <span class='api_def'>_show_new_img</span>( new_img_url, style_class=<span class='api_num'>'main_img'</span> ):
                            <div class='api_doc'>
                            Shows a new image,
                            new_img_url' is the path/url to the new image
                            style_class' is the name of the css class
                            fading or other animations are done by css
                            this fires _del_old_img() with a delay
                            </div>
                            <span class='api_def'>_del_old_img</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Removes bottom img
                            </div>
                            <span class='api_def'>_show_txt</span>( txt=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Updates the text in 'main_txt',
                            if txt is False/None the text box will be hidden
                            </div>
                            <span class='api_def'>_show_npc</span>( npc_img ):
                            <div class='api_doc'>
                            Show or hide the npc image
                            </div>
                            <span class='api_def'>num_pc_bodymods</span>( mod_type=<span class='api_num'>'piercing'</span> ):
                            <div class='api_doc'>
                             Get the number of body modifications the PC currently has
                            mod_type can be 'piercing' or 'tattoo
                            </div>
                            <span class='api_def'>add_pc_bodymod</span>( name, img, mod_type=<span class='api_num'>'piercing'</span> ):
                            <div class='api_doc'>
                             Add a body modifications image
                            mod_type can be 'piercing' or 'tattoo
                            This function will silently fail if PC has 3 or more bodymods of that type
                            </div>
                            <span class='api_def'>show_pc</span>( visible=<span class='api_num'>True</span>, face=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Show the pc avatar image with the current clothing and face
                            </div>
                            <span class='api_def'>update_stats</span>(  ):
                            <div class='api_doc'>
                             Updates the player stats
                            currently adds +1 max_slut for every 4 points of slut
                            </div>
                            
                            <span class='api_def'>_apply_url_param</span>( key, value=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Do something based on the parameters passed in via the url
                            </div>
                            <span class='api_def'>checksum</span>( chsm=<span class='api_num'>3865</span>, trg=<span class='api_num'>'chsm'</span> ):
                            <div class='api_doc'>
                            Run a checksum test
                            </div>

                            Save utilities:<br>
                            <span class='api_def'>init_new_save</span>(  ):
                            <div class='api_doc'>
                             Resets all values in the save and inventory
                            to the initial values expected by the game.
                            </div>
                            <span class='api_def'>_cleanup_save</span>(  ):
                            <div class='api_doc'>
                             Clean up save from all unused data
                            </div>
                            <span class='api_def'>restore_last</span>(  ):
                            <div class='api_doc'>
                            Restore the background npc and pc images to the last saved state
                            </div>
                            <span class='api_def'>_set_is_cheer</span>(  ):
                            <div class='api_doc'>
                            helper func
                            </div>
                            <span class='api_def'>_set_is_not_cheer</span>(  ):
                            <div class='api_doc'>
                            helper func
                            </div>

                            Game plot navigation:<br>
                            <span class='api_def'>_add_choice</span>( label, condition, target, rollback=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                             If eval(condition) is True:
                            Adds a new choice button with label text, pointing to target node.
                            Calling this function also hides the character sheet and button.
                            </div>
                            <span class='api_def'>_restore_rollback</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Restores the rollback from a save
                            </div>
                            <span class='api_def'>_on_choice_click</span>( target, rollback, label ):
                            <div class='api_doc'>
                            Executed when player clicks on a choice button
                            </div>
                            <span class='api_def'>move_to</span>( target, rollback=<span class='api_num'>False</span> ):
                            <div class='api_doc'>
                             Moves to the target plot node
                            if rollback is True, a rollback point is saved
                            </div>
                            <span class='api_def'>_move_to_next</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Moves to the next plot node
                            </div>


                            Map<br>
                            <span class='api_def'>add_poi</span>( name ):
                            <div class='api_doc'>
                            Add a Point Of Interest to the list of known POIs
                            </div>
                            <span class='api_def'>del_poi</span>( name ):
                            <div class='api_doc'>
                             Removes a Point Of Interest to the list of known POIs
                            </div>
                            <span class='api_def'>show_map</span>( poi_list=<span class='api_num'>None</span>, show_known=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                             Shows the map screen updates the map pins POI
                            </div>
                            <span class='api_def'>_add_marker</span>( label, icon, target, x, y ):
                            <div class='api_doc'>
                             Adds a marker to the map screen
                            </div>
                            <span class='api_def'>remove_map_event</span>( target, from_poi=<span class='api_num'>None</span>, target_poi=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Removes a dynamic map event,
                            If target is None this will remove ALL map events for the  from_poi/target_poi
                            </div>
                            <span class='api_def'>set_map_event</span>( target, from_poi=<span class='api_num'>None</span>, target_poi=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Sets a dynamic map event
                            </div>
                            <span class='api_def'>_get_map_event</span>( from_poi, target_poi ):
                            <div class='api_doc'>
                             Returns a map event based on the current location, target, time, random etc
                            If no suitable event exists returns None
                            </div>
                            <span class='api_def'>_on_marker_click</span>( event ):
                            <div class='api_doc'>
                            Fired when player clicks on a map marker,
                            EITHER moves to the plot node encoded in the event.target.id
                            OR moves to a map event
                            </div>

                            Audio/music/tts:<br>
                            <span class='api_def'>tts_actor</span>( actor_name ):
                            <div class='api_doc'>
                             Set/override the tts speaker for one text box
                            Use in formatted text eg. { tts_actor('mnpc') }
                            </div>
                            <span class='api_def'>_make_voice_select</span>( actor_name ):
                            <div class='api_doc'>
                             Creates some html tags for the user to select tts voices
                            </div>
                            <span class='api_def'>_show_tts_setup</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Toggles the tts setup panel
                            </div>
                            <span class='api_def'>_set_tts_pitch</span>( event ):
                            <div class='api_doc'>
                             Set the pitch for a specific actor voice,
                            the actor name is encoded in the event
                            </div>
                            <span class='api_def'>_set_tts_speed</span>( event ):
                            <div class='api_doc'>
                             Set the speed/rate for a specific actor voice,
                            the actor name is encoded in the event
                            </div>
                            <span class='api_def'>_set_tts_lang</span>( event ):
                            <div class='api_doc'>
                            Sets the tts language(?)
                            </div>
                            <span class='api_def'>_set_tts_voice</span>( event ):
                            <div class='api_doc'>
                             Set the name of a specific actor voice,
                            the actor name is encoded in the event
                            </div>
                            <span class='api_def'>_test_voice</span>( event ):
                            <div class='api_doc'>
                             Use the specific actor voice/pitch/speed setup to speak a test sentence.
                            </div>
                            <span class='api_def'>_save_tts_volume</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Fired when the user changes tts volume
                            Saves the current volume value to the storage
                            </div>
                            <span class='api_def'>_speak</span>( text, speaker=<span class='api_num'>'default'</span> ):
                            <div class='api_doc'>
                             Use TTS to convert the 'text' to audio
                            </div>
                            <span class='api_def'>_save_music_volume</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Fired when the user changes music volume
                            Saves the current volume value to the storage
                            </div>
                            <span class='api_def'>music</span>( name, loop=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                            Alias for play_music
                            </div>
                            <span class='api_def'>_on_end_music_loop</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Event that loops the music if it ends.
                            </div>
                            <span class='api_def'>play_music</span>( url=<span class='api_num'>None</span>, loop=<span class='api_num'>True</span> ):
                            <div class='api_doc'>
                            Play a music(.mp3) file using the browsers build-in player
                            Same Origin Policy applies(?).
                            </div>

                            Zoom functions:<br>
                            <span class='api_def'>_on_resize</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                            Resets zoom and updates sizes when the browser window is resized
                            </div>
                            <span class='api_def'>_reset_zoom</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Reset the font and image zoom to default values
                            </div>
                            <span class='api_def'>_set_zoom</span>( zoom_level ):
                            <div class='api_doc'>
                            Set the zoom level to zoom_level
                            </div>
                            <span class='api_def'>_set_font_zoom</span>( zoom_level ):
                            <div class='api_doc'>
                            Set the font zoom to  zoom_level%, use int as zoom_level
                            </div>
                            <span class='api_def'>_zoom</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Change the size of the game area, keeping font size
                            </div>
                            <span class='api_def'>_zoom_font</span>( event=<span class='api_num'>None</span> ):
                            <div class='api_doc'>
                             Change the font size
                            </div>
                        </div>

                    <a href='#top'>[Back to top]</a>
                </article>
                <br>
                <div class='license'>
                    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
                        <img alt="Creative Commons License" style="border-width:0" src="manual_img/88x31.png" />
                    </a>
                    <br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                </div>
        </main>
    </div>
</body>
